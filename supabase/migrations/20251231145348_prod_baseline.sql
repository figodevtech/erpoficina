create type "public"."banco_tipo" as enum ('CORRENTE', 'POUPANCA', 'DIGITAL', 'PAGAMENTO', 'SALARIO', 'EMPRESARIAL');

create type "public"."categoria_transacao" as enum ('SERVICO', 'PRODUTO', 'TRANSPORTE_LOGISTICA', 'COMISSAO_REPASSE', 'TRANSFERENCIA', 'ALUGUEL', 'EQUIPAMENTO_FERRAMENTA', 'OUTROS', 'PECA', 'SALARIO', 'IMPOSTO_TAXA', 'UTILIDADE', 'ORDEM_SERVICO', 'VENDA');

create type "public"."cliente_rank" as enum ('EXCELENTE', 'ALTO', 'NORMAL', 'BAIXO');

create type "public"."enum_alvo_reparo" as enum ('VEICULO', 'PECA');

create type "public"."enum_ambiente_nfe" as enum ('HOMOLOGACAO', 'PRODUCAO');

create type "public"."enum_estoque_status_produto" as enum ('OK', 'BAIXO', 'CRITICO', 'SEM_ESTOQUE');

create type "public"."enum_modelo_nfe" as enum ('NFE', 'NFCE');

create type "public"."enum_prioridade_os" as enum ('BAIXA', 'NORMAL', 'ALTA');

create type "public"."enum_status_aprovacao" as enum ('PENDENTE', 'APROVADA', 'REPROVADA');

create type "public"."enum_status_checklist" as enum ('OK', 'ALERTA', 'FALHA');

create type "public"."enum_status_cliente" as enum ('ATIVO', 'INATIVO', 'PENDENTE');

create type "public"."enum_status_nfe" as enum ('RASCUNHO', 'ASSINADA', 'ENVIADA', 'AUTORIZADA', 'REJEITADA', 'CANCELADA', 'PENDENTE_ENVIO', 'DENEGADA');

create type "public"."enum_status_os" as enum ('ORCAMENTO', 'EM_ANDAMENTO', 'PAGAMENTO', 'CONCLUIDO', 'CANCELADO', 'APROVACAO_ORCAMENTO', 'ORCAMENTO_APROVADO', 'ORCAMENTO_RECUSADO', 'AGUARDANDO_CHECKLIST');

create type "public"."enum_status_venda" as enum ('ABERTA', 'PAGAMENTO', 'FINALIZADA', 'CANCELADA');

create type "public"."enum_tipo_desconto_venda" as enum ('PORCENTAGEM', 'FIXO');

create type "public"."enum_tipo_os" as enum ('MANUTENCAO', 'REVISAO', 'INSTALACAO', 'DIAGNOSTICO');

create type "public"."enum_tipo_pagamento" as enum ('DINHEIRO', 'CARTAO', 'PIX', 'BOLETO', 'TRANSFERENCIA');

create type "public"."enum_tipomovimentacao" as enum ('ENTRADA', 'SAIDA', 'AJUSTE');

create type "public"."enum_tipopessoa" as enum ('FISICA', 'JURIDICA');

create type "public"."estoque_status" as enum ('OK', 'BAIXO', 'CRITICO', 'SEM_ESTOQUE');

create type "public"."grupo_produto" as enum ('MOTOR', 'INJECAO ELETRONICA', 'IGNICAO', 'ARREFECIMENTO', 'AR CONDICIONADO/CLIMATIZACAO', 'LUBRIFICANTES E FLUIDOS', 'FILTROS', 'TRANSMISSAO', 'EMBREAGEM', 'DIFERENCIAL E EIXOS', 'DIRECAO', 'SUSPENSAO', 'FREIOS', 'PNEUS E RODAS', 'ESCAPAMENTO', 'ELETRICA', 'BATERIAS', 'ILUMINACAO/SINALIZACAO', 'SENSORES E ATUADORES', 'INSTRUMENTOS DE MEDICAO', 'DIAGNOSTICO E SCANNER', 'CARROCERIA/LATARIA', 'VIDROS/RETROVISORES', 'INTERIOR ACABAMENTOS', 'JUNTAS/RETENTORES ORINGS', 'CORREIAS/TENSORES', 'CABOS E MANGUEIRAS', 'FIXADORES/PARAFUSOS', 'COLAS E SELANTES', 'ADITIVOS E QUIMICOS', 'ESTETICA/LIMPEZA', 'MATERIAIS/PINTURA', 'ABRASIVOS/LIXAS', 'FERRAMENTAS MANUAIS', 'FERRAMENTAS ELETRICAS PNEUMATICAS', 'EQUIPAMENTOS DE OFICINA', 'EPI/SEGURANCA', 'ORGANIZACAO/ARMAZENAGEM', 'ACESSORIOS', 'OUTROS');

create type "public"."metodo_pagamento" as enum ('PIX', 'CREDITO', 'DEBITO', 'BOLETO', 'TRANSFERENCIA', 'DINHEIRO');

create type "public"."tipo_veiculo" as enum ('MOTOS', 'CARROS', 'CAMINHOES');

create type "public"."tipos_transacao" as enum ('RECEITA', 'DESPESA', 'DEPOSITO', 'SAQUE');

create type "public"."unidade_medida" as enum ('UN', 'JGO', 'KIT', 'PAR', 'CX', 'PCT');

create type "public"."user_role" as enum ('ADMIN', 'USER');

create sequence "public"."nfe_config_id_seq";

create sequence "public"."nfe_id_seq";

create sequence "public"."nfe_item_id_seq";

create sequence "public"."osaprovacao_id_seq";

create sequence "public"."pagamento_evento_id_seq";

create sequence "public"."pagamento_id_seq";


  create table "public"."bancoconta" (
    "id" bigint generated by default as identity not null,
    "titulo" text not null,
    "created_at" timestamp with time zone not null,
    "valorinicial" real not null,
    "agencia" text,
    "contanumero" text,
    "tipo" public.banco_tipo not null default 'CORRENTE'::public.banco_tipo,
    "proprietario" text,
    "empresa_id" integer,
    "updated_at" timestamp with time zone not null,
    "ativo" boolean default true
      );



  create table "public"."categoriaservico" (
    "id" integer generated always as identity not null,
    "nome" character varying not null,
    "descricao" character varying
      );



  create table "public"."categoriatransacao" (
    "id" integer generated always as identity not null,
    "nome" text not null,
    "descricao" text,
    "ativo" boolean not null default true,
    "createdat" timestamp without time zone default now(),
    "updatedat" timestamp without time zone default now()
      );



  create table "public"."checklist" (
    "id" integer generated always as identity not null,
    "ordemservicoid" integer not null,
    "item" character varying not null,
    "status" public.enum_status_checklist not null default 'OK'::public.enum_status_checklist,
    "observacao" character varying,
    "createdat" timestamp without time zone default now()
      );



  create table "public"."checklist_modelo" (
    "id" integer generated always as identity not null,
    "nome" character varying not null,
    "descricao" character varying,
    "categoria" character varying,
    "ativo" boolean not null default true,
    "criado_em" timestamp without time zone not null default now(),
    "atualizado_em" timestamp without time zone not null default now()
      );



  create table "public"."checklist_modelo_item" (
    "id" integer generated always as identity not null,
    "modelo_id" integer not null,
    "titulo" character varying not null,
    "descricao" character varying,
    "categoria" character varying,
    "obrigatorio" boolean not null default false,
    "ordem" integer not null default 0
      );



  create table "public"."cliente" (
    "id" integer generated always as identity not null,
    "tipopessoa" public.enum_tipopessoa not null,
    "cpfcnpj" character varying not null,
    "nomerazaosocial" character varying not null,
    "email" character varying not null,
    "telefone" character varying not null,
    "endereco" character varying,
    "cidade" character varying not null,
    "estado" character varying not null,
    "cep" character varying,
    "inscricaoestadual" character varying,
    "inscricaomunicipal" character varying,
    "codigomunicipio" character varying,
    "createdat" timestamp without time zone default now(),
    "updatedat" timestamp without time zone default now(),
    "status" public.enum_status_cliente default 'ATIVO'::public.enum_status_cliente,
    "endereconumero" text,
    "enderecocomplemento" text,
    "bairro" text,
    "created_by" uuid,
    "updated_by" uuid,
    "is_deleted" boolean not null default false,
    "deleted_at" timestamp with time zone,
    "deleted_by" uuid,
    "rank" public.cliente_rank,
    "ranked_by" uuid,
    "ranked_at" timestamp with time zone
      );



  create table "public"."cores_veiculos" (
    "id" integer generated always as identity not null,
    "nome" text not null,
    "ativo" boolean not null default true,
    "created_at" timestamp with time zone not null default now(),
    "created_by" uuid,
    "updated_at" timestamp with time zone not null default now(),
    "updated_by" uuid
      );



  create table "public"."empresa" (
    "id" integer generated always as identity not null,
    "cnpj" character varying not null,
    "razaosocial" character varying not null,
    "nomefantasia" character varying,
    "inscricaoestadual" character varying,
    "inscricaomunicipal" character varying,
    "endereco" character varying not null,
    "codigomunicipio" character varying not null,
    "regimetributario" character varying not null,
    "certificadocaminho" character varying,
    "cschomologacao" character varying,
    "cscproducao" character varying,
    "ambiente" character varying default 'HOMOLOGACAO'::character varying,
    "createdat" timestamp without time zone default now(),
    "updatedat" timestamp without time zone default now(),
    "bairro" character varying,
    "numero" character varying,
    "complemento" character varying,
    "cep" character varying,
    "uf" character varying(2),
    "codigopais" character varying default '1058'::character varying,
    "nomepais" character varying default 'BRASIL'::character varying,
    "telefone" character varying,
    "cnae" character varying,
    "inscricaoestadualst" character varying,
    "certificadosenha" character varying
      );



  create table "public"."fornecedor" (
    "id" integer generated always as identity not null,
    "cpfcnpj" character varying not null,
    "nomerazaosocial" text not null,
    "nomefantasia" character varying,
    "endereco" character varying,
    "cidade" character varying,
    "estado" character varying,
    "cep" character varying,
    "contato" character varying,
    "createdat" timestamp without time zone default now(),
    "updatedat" timestamp without time zone default now(),
    "endereconumero" text,
    "enderecocomplemento" text,
    "bairro" text,
    "ativo" boolean not null default true
      );



  create table "public"."fornecedorprodutos" (
    "id" bigint generated by default as identity not null,
    "created_at" timestamp with time zone not null default now(),
    "fornecedorid" integer not null,
    "produtoid" integer not null,
    "codigofornecedor" text not null,
    "ultimovalordecompra" numeric
      );


alter table "public"."fornecedorprodutos" enable row level security;


  create table "public"."imagemvistoria" (
    "id" integer generated always as identity not null,
    "checklistid" integer not null,
    "url" character varying not null,
    "descricao" character varying,
    "createdat" timestamp without time zone default now()
      );



  create table "public"."nfe" (
    "id" bigint not null default nextval('public.nfe_id_seq'::regclass),
    "modelo" public.enum_modelo_nfe not null default 'NFE'::public.enum_modelo_nfe,
    "serie" integer not null,
    "numero" integer not null,
    "chave_acesso" character(44) not null,
    "ambiente" public.enum_ambiente_nfe not null default 'HOMOLOGACAO'::public.enum_ambiente_nfe,
    "status" public.enum_status_nfe not null default 'RASCUNHO'::public.enum_status_nfe,
    "ordemservicoid" integer,
    "vendaid" integer,
    "clienteid" integer not null,
    "dataemissao" timestamp with time zone not null,
    "dataautorizacao" timestamp with time zone,
    "protocolo" text,
    "total_produtos" numeric(14,2) not null default 0,
    "total_servicos" numeric(14,2) not null default 0,
    "total_nfe" numeric(14,2) not null default 0,
    "xml_assinado" text,
    "xml_autorizado" text,
    "justificativacancelamento" text,
    "createdat" timestamp with time zone not null default now(),
    "updatedat" timestamp with time zone not null default now(),
    "empresaid" integer not null,
    "icms" text,
    "cfop" text,
    "created_by" uuid,
    "updated_by" uuid,
    "deleted_by" uuid,
    "is_deleted" boolean not null default false,
    "deleted_at" timestamp with time zone
      );



  create table "public"."nfe_config" (
    "id" bigint not null default nextval('public.nfe_config_id_seq'::regclass),
    "empresaid" bigint not null,
    "modelo" public.enum_modelo_nfe not null default 'NFE'::public.enum_modelo_nfe,
    "serie" integer not null default 1,
    "ultimo_numero" integer not null default 0,
    "ambiente" public.enum_ambiente_nfe not null default 'HOMOLOGACAO'::public.enum_ambiente_nfe,
    "tp_emis" smallint not null default 1,
    "versao_layout" character varying(5) not null default '4.00'::character varying,
    "tipo_impressao_danfe" smallint not null default 1,
    "permitir_homologacao" boolean not null default true,
    "permitir_producao" boolean not null default true,
    "createdat" timestamp with time zone not null default now(),
    "updatedat" timestamp with time zone not null default now()
      );



  create table "public"."nfe_item" (
    "id" bigint not null default nextval('public.nfe_item_id_seq'::regclass),
    "nfe_id" bigint not null,
    "n_item" integer not null,
    "produtoid" integer,
    "descricao" text not null,
    "ncm" text,
    "cfop" text not null,
    "csosn" text,
    "cest" text,
    "unidade" public.unidade_medida not null,
    "quantidade" numeric(14,4) not null,
    "valor_unitario" numeric(14,10) not null,
    "valor_total" numeric(14,2) not null,
    "valor_desconto" numeric(14,2),
    "aliquotaicms" numeric(5,2),
    "valor_bc_icms" numeric(14,2),
    "valor_icms" numeric(14,2),
    "cst_pis" text,
    "aliquota_pis" numeric(5,2),
    "valor_pis" numeric(14,2),
    "cst_cofins" text,
    "aliquota_cofins" numeric(5,2),
    "valor_cofins" numeric(14,2),
    "createdat" timestamp with time zone not null default now(),
    "updatedat" timestamp with time zone not null default now(),
    "cst" text
      );



  create table "public"."nfse_config" (
    "empresa_id" integer not null,
    "provedor" text,
    "inscricao_municipal" text,
    "serie_rps" text,
    "usuario" text,
    "senha" text,
    "token" text,
    "certificado_a1_base64" text,
    "senha_certificado" text,
    "updated_at" timestamp with time zone default now()
      );



  create table "public"."notafiscal" (
    "id" integer generated always as identity not null,
    "ordemservicoid" integer,
    "vendaonlineid" integer,
    "tipo" character varying not null,
    "numero" character varying not null,
    "serie" character varying not null,
    "dataemissao" timestamp without time zone default now(),
    "xml" character varying,
    "protocolo" character varying,
    "status" character varying not null,
    "createdat" timestamp without time zone default now(),
    "updatedat" timestamp without time zone default now()
      );



  create table "public"."ordemservico" (
    "id" integer generated always as identity not null,
    "clienteid" integer not null,
    "veiculoid" integer,
    "usuariocriadorid" uuid not null,
    "setorid" integer,
    "status" public.enum_status_os default 'AGUARDANDO_CHECKLIST'::public.enum_status_os,
    "statusaprovacao" public.enum_status_aprovacao default 'PENDENTE'::public.enum_status_aprovacao,
    "descricao" character varying,
    "dataentrada" timestamp without time zone default now(),
    "datasaida" timestamp without time zone,
    "orcamentototal" numeric not null default '0'::numeric,
    "observacoes" character varying,
    "createdat" timestamp without time zone default now(),
    "updatedat" timestamp without time zone default now(),
    "checklist_modelo_id" integer,
    "prioridade" public.enum_prioridade_os not null default 'NORMAL'::public.enum_prioridade_os,
    "alvo_tipo" public.enum_alvo_reparo not null default 'VEICULO'::public.enum_alvo_reparo,
    "pecaid" integer,
    "execucao_inicio_em" timestamp with time zone,
    "execucao_fim_em" timestamp with time zone,
    "created_by" uuid,
    "updated_by" uuid,
    "deleted_at" timestamp with time zone,
    "deleted_by" uuid,
    "is_deleted" boolean not null default false
      );



  create table "public"."osaprovacao" (
    "id" bigint not null default nextval('public.osaprovacao_id_seq'::regclass),
    "ordemservicoid" integer not null,
    "token" uuid not null,
    "expira_em" timestamp with time zone,
    "usado_em" timestamp with time zone,
    "created_at" timestamp with time zone not null default now(),
    "origem" text,
    "resultado" text,
    "aprovador_doc" text,
    "aprovador_usuario_id" uuid
      );



  create table "public"."osproduto" (
    "ordemservicoid" integer not null,
    "produtoid" integer not null,
    "quantidade" integer default 1,
    "precounitario" numeric not null,
    "subtotal" numeric not null
      );



  create table "public"."osproduto_baixa" (
    "ordemservicoid" integer not null,
    "produtoid" integer not null,
    "quantidade" integer not null default 0
      );



  create table "public"."osservico" (
    "ordemservicoid" integer not null,
    "servicoid" integer not null,
    "quantidade" integer default 1,
    "precounitario" numeric not null,
    "subtotal" numeric not null,
    "idusuariorealizador" uuid
      );



  create table "public"."pagamento" (
    "id" bigint not null default nextval('public.pagamento_id_seq'::regclass),
    "ordemservicoid" integer not null,
    "metodo" text not null,
    "valor" numeric not null,
    "status" text not null default 'CRIADO'::text,
    "provider_tx_id" text,
    "nsu" text,
    "autorizacao" text,
    "bandeira" text,
    "parcelas" integer default 1,
    "comprovante" text,
    "criado_em" timestamp with time zone default now(),
    "atualizado_em" timestamp with time zone default now()
      );



  create table "public"."pagamento_config" (
    "empresa_id" integer not null,
    "provider_cartao" text default 'stone'::text,
    "cartao_merchant_id" text,
    "cartao_api_key" text,
    "cartao_webhook_url" text,
    "cartao_parcelas_max" integer default 1,
    "cartao_captura_auto" boolean default true,
    "cartao_terminal_ids" text[] default '{}'::text[],
    "pix_provider" text default 'stone'::text,
    "pix_chave" text,
    "pix_client_id" text,
    "pix_client_secret" text,
    "pix_webhook_url" text,
    "pix_expiracao_s" integer default 1800,
    "dinheiro_habilitado" boolean default true,
    "updated_at" timestamp with time zone default now()
      );



  create table "public"."pagamento_evento" (
    "id" bigint not null default nextval('public.pagamento_evento_id_seq'::regclass),
    "pagamentoid" bigint not null,
    "tipo" text not null,
    "payload" jsonb,
    "criado_em" timestamp with time zone default now()
      );



  create table "public"."peca" (
    "id" integer generated always as identity not null,
    "clienteid" integer not null,
    "veiculoid" integer,
    "titulo" text not null,
    "descricao" text,
    "fabricante" text,
    "modelo" text,
    "codigo" text,
    "createdat" timestamp without time zone default now(),
    "updatedat" timestamp without time zone default now()
      );



  create table "public"."perfil" (
    "id" integer generated always as identity not null,
    "nome" character varying not null,
    "descricao" character varying,
    "createdat" timestamp without time zone default now(),
    "updatedat" timestamp without time zone default now()
      );



  create table "public"."perfilpermissao" (
    "perfilid" integer not null,
    "permissaoid" integer not null,
    "createdat" timestamp without time zone default now()
      );



  create table "public"."permissao" (
    "id" integer generated always as identity not null,
    "nome" character varying not null,
    "descricao" character varying
      );



  create table "public"."produto" (
    "id" integer generated always as identity not null,
    "descricao" text,
    "precovenda" numeric not null,
    "estoque" integer not null default 0,
    "estoqueminimo" integer not null default 0,
    "ncm" text,
    "unidade" public.unidade_medida not null default 'UN'::public.unidade_medida,
    "cest" text,
    "csosn" text,
    "codigobarras" text,
    "createdat" timestamp with time zone default now(),
    "updatedat" timestamp with time zone default now(),
    "referencia" text,
    "titulo" text not null,
    "status_estoque" public.estoque_status not null default 'OK'::public.estoque_status,
    "fabricante" text,
    "grupo" public.grupo_produto default 'OUTROS'::public.grupo_produto,
    "exibirPdv" boolean not null default false,
    "tituloMarketplace" text not null default ''::text,
    "descricaoMarketplace" text not null default ''::text,
    "cClassTrib" text,
    "cstIbs" text,
    "cstCbs" text,
    "cst" text,
    "aliquotaicms" numeric,
    "cfop" text,
    "cst_pis" text,
    "aliquota_pis" numeric(5,2),
    "cst_cofins" text,
    "aliquota_cofins" numeric(5,2),
    "imgUrl" text,
    "updated_by" uuid,
    "created_by" uuid,
    "is_deleted" boolean not null default false,
    "deleted_at" timestamp with time zone,
    "deleted_by" uuid,
    "grupo_produto_id" integer not null default 1,
    "tipo_unidade_id" integer not null default 1
      );



  create table "public"."produto_imagem" (
    "id" bigint generated always as identity not null,
    "produto_id" integer not null,
    "url" text not null,
    "path" text not null,
    "ordem" integer not null default 0,
    "createdat" timestamp with time zone not null default now()
      );



  create table "public"."produtoentrada" (
    "id" bigint generated by default as identity not null,
    "quantidade" integer not null,
    "created_at" timestamp with time zone not null default now(),
    "produtoid" integer not null,
    "fornecedorid" integer,
    "fiscal" boolean not null default false,
    "notachave" text
      );



  create table "public"."produtogrupo" (
    "id" integer generated always as identity not null,
    "nome" text not null,
    "descricao" text,
    "ativo" boolean not null default true,
    "createdat" timestamp without time zone not null default now(),
    "updatedat" timestamp without time zone not null default now()
      );



  create table "public"."servico" (
    "id" integer generated always as identity not null,
    "codigo" character varying not null,
    "descricao" character varying not null,
    "precohora" numeric not null,
    "codigoservicomunicipal" character varying not null,
    "aliquotaiss" numeric,
    "cnae" character varying,
    "itemlistaservico" character varying not null,
    "tiposervicoid" integer,
    "createdat" timestamp without time zone default now(),
    "updatedat" timestamp without time zone default now(),
    "ativo" boolean default true
      );



  create table "public"."setor" (
    "id" integer generated always as identity not null,
    "nome" character varying not null,
    "descricao" character varying,
    "responsavel" text,
    "ativo" boolean not null default true
      );



  create table "public"."tiposervico" (
    "id" integer generated always as identity not null,
    "nome" character varying not null,
    "descricao" character varying,
    "categoriaid" integer not null
      );



  create table "public"."transacao" (
    "id" bigint generated by default as identity not null,
    "created_at" timestamp with time zone not null default now(),
    "updated_at" timestamp with time zone not null default now(),
    "descricao" text not null,
    "valor" numeric(14,2) not null,
    "data" timestamp with time zone not null,
    "metodopagamento" public.metodo_pagamento not null,
    "categoria" text not null default 'N√ÉO RELACIONADO'::text,
    "tipo" public.tipos_transacao not null,
    "cliente_id" integer,
    "banco_id" bigint not null,
    "nomepagador" text not null,
    "cpfcnpjpagador" text not null,
    "ordemservicoid" integer,
    "valorLiquido" numeric,
    "vendaid" integer,
    "pendente" boolean not null default false,
    "created_by" uuid,
    "updated_by" uuid,
    "is_deleted" boolean not null default false,
    "deleted_at" timestamp with time zone,
    "deleted_by" uuid
      );



  create table "public"."transferencias_veiculos" (
    "id" bigint generated by default as identity not null,
    "created_at" timestamp with time zone not null default now(),
    "veiculo_id" integer,
    "dono_anteior" integer,
    "novo_dono" integer,
    "created_by" uuid
      );


alter table "public"."transferencias_veiculos" enable row level security;


  create table "public"."unidademedida" (
    "id" integer generated always as identity not null,
    "sigla" character varying not null,
    "descricao" text,
    "ativo" boolean not null default true,
    "createdat" timestamp without time zone not null default now(),
    "updatedat" timestamp without time zone not null default now()
      );



  create table "public"."usuario" (
    "id" uuid not null default gen_random_uuid(),
    "email" character varying not null,
    "nome" character varying not null,
    "setorid" integer,
    "perfilid" integer,
    "createdat" timestamp without time zone default now(),
    "updatedat" timestamp without time zone default now(),
    "ativo" boolean not null default true
      );



  create table "public"."veiculo" (
    "id" integer generated always as identity not null,
    "clienteid" integer not null,
    "placa" character varying not null,
    "modelo" text not null,
    "marca" text not null,
    "ano" integer,
    "cor" character varying,
    "kmatual" integer,
    "createdat" timestamp without time zone default now(),
    "updatedat" timestamp without time zone default now(),
    "placa_formatada" text not null generated always as (public.to_mercosul_equivalente((placa)::text)) stored,
    "tipo" public.tipo_veiculo not null default 'CARROS'::public.tipo_veiculo
      );



  create table "public"."venda" (
    "id" integer generated always as identity not null,
    "clienteid" integer not null,
    "status" public.enum_status_venda not null,
    "valortotal" numeric not null,
    "datavenda" timestamp with time zone,
    "createdat" timestamp with time zone,
    "updatedat" timestamp with time zone,
    "created_by" uuid,
    "desconto_tipo" public.enum_tipo_desconto_venda,
    "desconto_valor" numeric,
    "sub_total" numeric not null
      );



  create table "public"."vendaproduto" (
    "id" bigint generated by default as identity not null,
    "created_at" timestamp with time zone not null default now(),
    "updated_at" timestamp with time zone default now(),
    "venda_id" integer not null,
    "produtoid" integer not null,
    "sub_total" numeric not null,
    "valor_total" numeric not null,
    "valor_desconto" numeric,
    "tipo_desconto" public.enum_tipo_desconto_venda,
    "quantidade" integer not null
      );


alter sequence "public"."nfe_config_id_seq" owned by "public"."nfe_config"."id";

alter sequence "public"."nfe_id_seq" owned by "public"."nfe"."id";

alter sequence "public"."nfe_item_id_seq" owned by "public"."nfe_item"."id";

alter sequence "public"."osaprovacao_id_seq" owned by "public"."osaprovacao"."id";

alter sequence "public"."pagamento_evento_id_seq" owned by "public"."pagamento_evento"."id";

alter sequence "public"."pagamento_id_seq" owned by "public"."pagamento"."id";

CREATE UNIQUE INDEX banco_conta_pkey ON public.bancoconta USING btree (id);

CREATE UNIQUE INDEX categoria_transacao_nome_key ON public.categoriatransacao USING btree (nome);

CREATE UNIQUE INDEX categoriaservico_pkey ON public.categoriaservico USING btree (id);

CREATE UNIQUE INDEX categoriatransacao_pkey ON public.categoriatransacao USING btree (id);

CREATE UNIQUE INDEX checklist_modelo_item_pkey ON public.checklist_modelo_item USING btree (id);

CREATE UNIQUE INDEX checklist_modelo_nome_key ON public.checklist_modelo USING btree (nome);

CREATE UNIQUE INDEX checklist_modelo_pkey ON public.checklist_modelo USING btree (id);

CREATE UNIQUE INDEX checklist_pkey ON public.checklist USING btree (id);

CREATE UNIQUE INDEX cliente_cpfcnpj_key ON public.cliente USING btree (cpfcnpj);

CREATE UNIQUE INDEX cliente_nomerazaosocial_key ON public.cliente USING btree (nomerazaosocial);

CREATE UNIQUE INDEX cliente_pkey ON public.cliente USING btree (id);

CREATE UNIQUE INDEX cliente_telefone_key ON public.cliente USING btree (telefone);

CREATE UNIQUE INDEX cores_veiculos_nome_key ON public.cores_veiculos USING btree (nome);

CREATE UNIQUE INDEX cores_veiculos_pkey ON public.cores_veiculos USING btree (id);

CREATE UNIQUE INDEX empresa_cnpj_key ON public.empresa USING btree (cnpj);

CREATE UNIQUE INDEX empresa_pkey ON public.empresa USING btree (id);

CREATE UNIQUE INDEX fornecedor_cnpj_key ON public.fornecedor USING btree (cpfcnpj);

CREATE UNIQUE INDEX fornecedor_pkey ON public.fornecedor USING btree (id);

CREATE UNIQUE INDEX fornecedorprodutos_pkey ON public.fornecedorprodutos USING btree (id);

CREATE INDEX idx_checklist_modelo_item_modelo ON public.checklist_modelo_item USING btree (modelo_id);

CREATE INDEX idx_cliente_cpfcnpj ON public.cliente USING btree (cpfcnpj);

CREATE INDEX idx_nfe_cliente ON public.nfe USING btree (clienteid);

CREATE INDEX idx_nfe_item_nfe ON public.nfe_item USING btree (nfe_id);

CREATE INDEX idx_nfe_item_produto ON public.nfe_item USING btree (produtoid);

CREATE INDEX idx_nfe_ordemservico ON public.nfe USING btree (ordemservicoid);

CREATE INDEX idx_nfe_status ON public.nfe USING btree (status);

CREATE INDEX idx_nfe_venda ON public.nfe USING btree (vendaid);

CREATE INDEX idx_ordemservico_clienteid ON public.ordemservico USING btree (clienteid);

CREATE INDEX idx_ordemservico_setorid ON public.ordemservico USING btree (setorid);

CREATE INDEX idx_os_cliente ON public.ordemservico USING btree (clienteid);

CREATE INDEX idx_os_status ON public.ordemservico USING btree (status);

CREATE INDEX idx_transacao_ordemservicoid ON public.transacao USING btree (ordemservicoid);

CREATE INDEX idx_usuario_email ON public.usuario USING btree (email);

CREATE UNIQUE INDEX imagemvistoria_pkey ON public.imagemvistoria USING btree (id);

CREATE UNIQUE INDEX nfe_chave_acesso_key ON public.nfe USING btree (chave_acesso);

CREATE UNIQUE INDEX nfe_config_empresaid_key ON public.nfe_config USING btree (empresaid);

CREATE UNIQUE INDEX nfe_config_pkey ON public.nfe_config USING btree (id);

CREATE UNIQUE INDEX nfe_item_pkey ON public.nfe_item USING btree (id);

CREATE UNIQUE INDEX nfe_pkey ON public.nfe USING btree (id);

CREATE UNIQUE INDEX nfse_config_pkey ON public.nfse_config USING btree (empresa_id);

CREATE UNIQUE INDEX notafiscal_pkey ON public.notafiscal USING btree (id);

CREATE UNIQUE INDEX ordemservico_pkey ON public.ordemservico USING btree (id);

CREATE INDEX osaprovacao_ordem_idx ON public.osaprovacao USING btree (ordemservicoid);

CREATE UNIQUE INDEX osaprovacao_pkey ON public.osaprovacao USING btree (id);

CREATE UNIQUE INDEX osaprovacao_token_key ON public.osaprovacao USING btree (token);

CREATE UNIQUE INDEX osproduto_baixa_pkey ON public.osproduto_baixa USING btree (ordemservicoid, produtoid);

CREATE UNIQUE INDEX osproduto_pkey ON public.osproduto USING btree (ordemservicoid, produtoid);

CREATE UNIQUE INDEX osservico_pkey ON public.osservico USING btree (ordemservicoid, servicoid);

CREATE UNIQUE INDEX pagamento_config_pkey ON public.pagamento_config USING btree (empresa_id);

CREATE UNIQUE INDEX pagamento_evento_pkey ON public.pagamento_evento USING btree (id);

CREATE UNIQUE INDEX pagamento_pkey ON public.pagamento USING btree (id);

CREATE UNIQUE INDEX peca_pkey ON public.peca USING btree (id);

CREATE UNIQUE INDEX perfil_nome_key ON public.perfil USING btree (nome);

CREATE UNIQUE INDEX perfil_pkey ON public.perfil USING btree (id);

CREATE UNIQUE INDEX perfilpermissao_pkey ON public.perfilpermissao USING btree (perfilid, permissaoid);

CREATE UNIQUE INDEX permissao_nome_key ON public.permissao USING btree (nome);

CREATE UNIQUE INDEX permissao_pkey ON public.permissao USING btree (id);

CREATE UNIQUE INDEX produto_imagem_pkey ON public.produto_imagem USING btree (id);

CREATE INDEX produto_imagem_produto_id_idx ON public.produto_imagem USING btree (produto_id);

CREATE UNIQUE INDEX produto_imagem_produto_path_uq ON public.produto_imagem USING btree (path);

CREATE UNIQUE INDEX produto_pkey ON public.produto USING btree (id);

CREATE UNIQUE INDEX produtoentrada_pkey ON public.produtoentrada USING btree (id);

CREATE UNIQUE INDEX produtogrupo_pkey ON public.produtogrupo USING btree (id);

CREATE UNIQUE INDEX servico_codigo_key ON public.servico USING btree (codigo);

CREATE UNIQUE INDEX servico_pkey ON public.servico USING btree (id);

CREATE UNIQUE INDEX setor_pkey ON public.setor USING btree (id);

CREATE UNIQUE INDEX tiposervico_pkey ON public.tiposervico USING btree (id);

CREATE UNIQUE INDEX transacao_pkey ON public.transacao USING btree (id);

CREATE UNIQUE INDEX transferencias_veiculos_pkey ON public.transferencias_veiculos USING btree (id);

CREATE UNIQUE INDEX unidademedida_pkey ON public.unidademedida USING btree (id);

CREATE UNIQUE INDEX unidademedida_sigla_key ON public.unidademedida USING btree (sigla);

CREATE UNIQUE INDEX usuario_email_key ON public.usuario USING btree (email);

CREATE UNIQUE INDEX usuario_pkey ON public.usuario USING btree (id);

CREATE UNIQUE INDEX veiculo_pkey ON public.veiculo USING btree (id);

CREATE UNIQUE INDEX veiculo_placa_formatada_key ON public.veiculo USING btree (placa_formatada);

CREATE UNIQUE INDEX veiculo_placa_key ON public.veiculo USING btree (placa);

CREATE UNIQUE INDEX vendaonline_pkey ON public.venda USING btree (id);

CREATE UNIQUE INDEX vendaproduto_pkey ON public.vendaproduto USING btree (id);

alter table "public"."bancoconta" add constraint "banco_conta_pkey" PRIMARY KEY using index "banco_conta_pkey";

alter table "public"."categoriaservico" add constraint "categoriaservico_pkey" PRIMARY KEY using index "categoriaservico_pkey";

alter table "public"."categoriatransacao" add constraint "categoriatransacao_pkey" PRIMARY KEY using index "categoriatransacao_pkey";

alter table "public"."checklist" add constraint "checklist_pkey" PRIMARY KEY using index "checklist_pkey";

alter table "public"."checklist_modelo" add constraint "checklist_modelo_pkey" PRIMARY KEY using index "checklist_modelo_pkey";

alter table "public"."checklist_modelo_item" add constraint "checklist_modelo_item_pkey" PRIMARY KEY using index "checklist_modelo_item_pkey";

alter table "public"."cliente" add constraint "cliente_pkey" PRIMARY KEY using index "cliente_pkey";

alter table "public"."cores_veiculos" add constraint "cores_veiculos_pkey" PRIMARY KEY using index "cores_veiculos_pkey";

alter table "public"."empresa" add constraint "empresa_pkey" PRIMARY KEY using index "empresa_pkey";

alter table "public"."fornecedor" add constraint "fornecedor_pkey" PRIMARY KEY using index "fornecedor_pkey";

alter table "public"."fornecedorprodutos" add constraint "fornecedorprodutos_pkey" PRIMARY KEY using index "fornecedorprodutos_pkey";

alter table "public"."imagemvistoria" add constraint "imagemvistoria_pkey" PRIMARY KEY using index "imagemvistoria_pkey";

alter table "public"."nfe" add constraint "nfe_pkey" PRIMARY KEY using index "nfe_pkey";

alter table "public"."nfe_config" add constraint "nfe_config_pkey" PRIMARY KEY using index "nfe_config_pkey";

alter table "public"."nfe_item" add constraint "nfe_item_pkey" PRIMARY KEY using index "nfe_item_pkey";

alter table "public"."nfse_config" add constraint "nfse_config_pkey" PRIMARY KEY using index "nfse_config_pkey";

alter table "public"."notafiscal" add constraint "notafiscal_pkey" PRIMARY KEY using index "notafiscal_pkey";

alter table "public"."ordemservico" add constraint "ordemservico_pkey" PRIMARY KEY using index "ordemservico_pkey";

alter table "public"."osaprovacao" add constraint "osaprovacao_pkey" PRIMARY KEY using index "osaprovacao_pkey";

alter table "public"."osproduto" add constraint "osproduto_pkey" PRIMARY KEY using index "osproduto_pkey";

alter table "public"."osproduto_baixa" add constraint "osproduto_baixa_pkey" PRIMARY KEY using index "osproduto_baixa_pkey";

alter table "public"."osservico" add constraint "osservico_pkey" PRIMARY KEY using index "osservico_pkey";

alter table "public"."pagamento" add constraint "pagamento_pkey" PRIMARY KEY using index "pagamento_pkey";

alter table "public"."pagamento_config" add constraint "pagamento_config_pkey" PRIMARY KEY using index "pagamento_config_pkey";

alter table "public"."pagamento_evento" add constraint "pagamento_evento_pkey" PRIMARY KEY using index "pagamento_evento_pkey";

alter table "public"."peca" add constraint "peca_pkey" PRIMARY KEY using index "peca_pkey";

alter table "public"."perfil" add constraint "perfil_pkey" PRIMARY KEY using index "perfil_pkey";

alter table "public"."perfilpermissao" add constraint "perfilpermissao_pkey" PRIMARY KEY using index "perfilpermissao_pkey";

alter table "public"."permissao" add constraint "permissao_pkey" PRIMARY KEY using index "permissao_pkey";

alter table "public"."produto" add constraint "produto_pkey" PRIMARY KEY using index "produto_pkey";

alter table "public"."produto_imagem" add constraint "produto_imagem_pkey" PRIMARY KEY using index "produto_imagem_pkey";

alter table "public"."produtoentrada" add constraint "produtoentrada_pkey" PRIMARY KEY using index "produtoentrada_pkey";

alter table "public"."produtogrupo" add constraint "produtogrupo_pkey" PRIMARY KEY using index "produtogrupo_pkey";

alter table "public"."servico" add constraint "servico_pkey" PRIMARY KEY using index "servico_pkey";

alter table "public"."setor" add constraint "setor_pkey" PRIMARY KEY using index "setor_pkey";

alter table "public"."tiposervico" add constraint "tiposervico_pkey" PRIMARY KEY using index "tiposervico_pkey";

alter table "public"."transacao" add constraint "transacao_pkey" PRIMARY KEY using index "transacao_pkey";

alter table "public"."transferencias_veiculos" add constraint "transferencias_veiculos_pkey" PRIMARY KEY using index "transferencias_veiculos_pkey";

alter table "public"."unidademedida" add constraint "unidademedida_pkey" PRIMARY KEY using index "unidademedida_pkey";

alter table "public"."usuario" add constraint "usuario_pkey" PRIMARY KEY using index "usuario_pkey";

alter table "public"."veiculo" add constraint "veiculo_pkey" PRIMARY KEY using index "veiculo_pkey";

alter table "public"."venda" add constraint "vendaonline_pkey" PRIMARY KEY using index "vendaonline_pkey";

alter table "public"."vendaproduto" add constraint "vendaproduto_pkey" PRIMARY KEY using index "vendaproduto_pkey";

alter table "public"."bancoconta" add constraint "bancoconta_empresa_id_fkey" FOREIGN KEY (empresa_id) REFERENCES public.empresa(id) not valid;

alter table "public"."bancoconta" validate constraint "bancoconta_empresa_id_fkey";

alter table "public"."categoriatransacao" add constraint "categoria_transacao_nome_key" UNIQUE using index "categoria_transacao_nome_key";

alter table "public"."checklist" add constraint "fk_checklist_ordem_servico" FOREIGN KEY (ordemservicoid) REFERENCES public.ordemservico(id) ON DELETE CASCADE not valid;

alter table "public"."checklist" validate constraint "fk_checklist_ordem_servico";

alter table "public"."checklist_modelo" add constraint "checklist_modelo_nome_key" UNIQUE using index "checklist_modelo_nome_key";

alter table "public"."checklist_modelo_item" add constraint "checklist_modelo_item_modelo_id_fkey" FOREIGN KEY (modelo_id) REFERENCES public.checklist_modelo(id) ON DELETE CASCADE not valid;

alter table "public"."checklist_modelo_item" validate constraint "checklist_modelo_item_modelo_id_fkey";

alter table "public"."cliente" add constraint "cliente_cpfcnpj_key" UNIQUE using index "cliente_cpfcnpj_key";

alter table "public"."cliente" add constraint "cliente_created_by_fkey" FOREIGN KEY (created_by) REFERENCES public.usuario(id) not valid;

alter table "public"."cliente" validate constraint "cliente_created_by_fkey";

alter table "public"."cliente" add constraint "cliente_deleted_by_fkey" FOREIGN KEY (deleted_by) REFERENCES public.usuario(id) not valid;

alter table "public"."cliente" validate constraint "cliente_deleted_by_fkey";

alter table "public"."cliente" add constraint "cliente_nomerazaosocial_key" UNIQUE using index "cliente_nomerazaosocial_key";

alter table "public"."cliente" add constraint "cliente_ranked_by_fkey" FOREIGN KEY (ranked_by) REFERENCES public.usuario(id) not valid;

alter table "public"."cliente" validate constraint "cliente_ranked_by_fkey";

alter table "public"."cliente" add constraint "cliente_telefone_key" UNIQUE using index "cliente_telefone_key";

alter table "public"."cliente" add constraint "cliente_updated_by_fkey" FOREIGN KEY (updated_by) REFERENCES public.usuario(id) not valid;

alter table "public"."cliente" validate constraint "cliente_updated_by_fkey";

alter table "public"."cores_veiculos" add constraint "cores_veiculos_created_by_fkey" FOREIGN KEY (created_by) REFERENCES auth.users(id) not valid;

alter table "public"."cores_veiculos" validate constraint "cores_veiculos_created_by_fkey";

alter table "public"."cores_veiculos" add constraint "cores_veiculos_nome_key" UNIQUE using index "cores_veiculos_nome_key";

alter table "public"."cores_veiculos" add constraint "cores_veiculos_updated_by_fkey" FOREIGN KEY (updated_by) REFERENCES auth.users(id) not valid;

alter table "public"."cores_veiculos" validate constraint "cores_veiculos_updated_by_fkey";

alter table "public"."empresa" add constraint "empresa_ambiente_check" CHECK (((ambiente)::text = ANY (ARRAY[('HOMOLOGACAO'::character varying)::text, ('PRODUCAO'::character varying)::text]))) not valid;

alter table "public"."empresa" validate constraint "empresa_ambiente_check";

alter table "public"."empresa" add constraint "empresa_cnpj_key" UNIQUE using index "empresa_cnpj_key";

alter table "public"."empresa" add constraint "empresa_regimetributario_check" CHECK (((regimetributario)::text = ANY (ARRAY[('1'::character varying)::text, ('2'::character varying)::text, ('3'::character varying)::text]))) not valid;

alter table "public"."empresa" validate constraint "empresa_regimetributario_check";

alter table "public"."fornecedor" add constraint "fornecedor_cnpj_key" UNIQUE using index "fornecedor_cnpj_key";

alter table "public"."fornecedorprodutos" add constraint "fornecedorprodutos_fornecedorid_fkey" FOREIGN KEY (fornecedorid) REFERENCES public.fornecedor(id) not valid;

alter table "public"."fornecedorprodutos" validate constraint "fornecedorprodutos_fornecedorid_fkey";

alter table "public"."fornecedorprodutos" add constraint "fornecedorprodutos_produtoid_fkey" FOREIGN KEY (produtoid) REFERENCES public.produto(id) ON DELETE CASCADE not valid;

alter table "public"."fornecedorprodutos" validate constraint "fornecedorprodutos_produtoid_fkey";

alter table "public"."imagemvistoria" add constraint "fk_imagem_vistoria_checklist" FOREIGN KEY (checklistid) REFERENCES public.checklist(id) not valid;

alter table "public"."imagemvistoria" validate constraint "fk_imagem_vistoria_checklist";

alter table "public"."nfe" add constraint "nfe_chave_acesso_key" UNIQUE using index "nfe_chave_acesso_key";

alter table "public"."nfe" add constraint "nfe_clienteid_fkey" FOREIGN KEY (clienteid) REFERENCES public.cliente(id) not valid;

alter table "public"."nfe" validate constraint "nfe_clienteid_fkey";

alter table "public"."nfe" add constraint "nfe_created_by_fkey" FOREIGN KEY (created_by) REFERENCES public.usuario(id) not valid;

alter table "public"."nfe" validate constraint "nfe_created_by_fkey";

alter table "public"."nfe" add constraint "nfe_deleted_by_fkey" FOREIGN KEY (deleted_by) REFERENCES public.usuario(id) not valid;

alter table "public"."nfe" validate constraint "nfe_deleted_by_fkey";

alter table "public"."nfe" add constraint "nfe_empresaid_fkey" FOREIGN KEY (empresaid) REFERENCES public.empresa(id) not valid;

alter table "public"."nfe" validate constraint "nfe_empresaid_fkey";

alter table "public"."nfe" add constraint "nfe_ordemservicoid_fkey" FOREIGN KEY (ordemservicoid) REFERENCES public.ordemservico(id) ON DELETE SET NULL not valid;

alter table "public"."nfe" validate constraint "nfe_ordemservicoid_fkey";

alter table "public"."nfe" add constraint "nfe_updated_by_fkey" FOREIGN KEY (updated_by) REFERENCES public.usuario(id) not valid;

alter table "public"."nfe" validate constraint "nfe_updated_by_fkey";

alter table "public"."nfe" add constraint "nfe_vendaid_fkey" FOREIGN KEY (vendaid) REFERENCES public.venda(id) ON DELETE SET NULL not valid;

alter table "public"."nfe" validate constraint "nfe_vendaid_fkey";

alter table "public"."nfe_config" add constraint "nfe_config_empresaid_fkey" FOREIGN KEY (empresaid) REFERENCES public.empresa(id) ON DELETE CASCADE not valid;

alter table "public"."nfe_config" validate constraint "nfe_config_empresaid_fkey";

alter table "public"."nfe_config" add constraint "nfe_config_empresaid_key" UNIQUE using index "nfe_config_empresaid_key";

alter table "public"."nfe_item" add constraint "nfe_item_nfe_id_fkey" FOREIGN KEY (nfe_id) REFERENCES public.nfe(id) ON DELETE CASCADE not valid;

alter table "public"."nfe_item" validate constraint "nfe_item_nfe_id_fkey";

alter table "public"."nfe_item" add constraint "nfe_item_produtoid_fkey" FOREIGN KEY (produtoid) REFERENCES public.produto(id) not valid;

alter table "public"."nfe_item" validate constraint "nfe_item_produtoid_fkey";

alter table "public"."nfse_config" add constraint "nfse_config_empresa_id_fkey" FOREIGN KEY (empresa_id) REFERENCES public.empresa(id) ON DELETE CASCADE not valid;

alter table "public"."nfse_config" validate constraint "nfse_config_empresa_id_fkey";

alter table "public"."notafiscal" add constraint "fk_nota_fiscal_ordem_servico" FOREIGN KEY (ordemservicoid) REFERENCES public.ordemservico(id) not valid;

alter table "public"."notafiscal" validate constraint "fk_nota_fiscal_ordem_servico";

alter table "public"."notafiscal" add constraint "fk_nota_fiscal_venda_online" FOREIGN KEY (vendaonlineid) REFERENCES public.venda(id) not valid;

alter table "public"."notafiscal" validate constraint "fk_nota_fiscal_venda_online";

alter table "public"."ordemservico" add constraint "fk_ordem_servico_cliente" FOREIGN KEY (clienteid) REFERENCES public.cliente(id) not valid;

alter table "public"."ordemservico" validate constraint "fk_ordem_servico_cliente";

alter table "public"."ordemservico" add constraint "fk_ordem_servico_setor" FOREIGN KEY (setorid) REFERENCES public.setor(id) not valid;

alter table "public"."ordemservico" validate constraint "fk_ordem_servico_setor";

alter table "public"."ordemservico" add constraint "fk_ordem_servico_usuario" FOREIGN KEY (usuariocriadorid) REFERENCES public.usuario(id) not valid;

alter table "public"."ordemservico" validate constraint "fk_ordem_servico_usuario";

alter table "public"."ordemservico" add constraint "fk_ordem_servico_veiculo" FOREIGN KEY (veiculoid) REFERENCES public.veiculo(id) ON DELETE CASCADE not valid;

alter table "public"."ordemservico" validate constraint "fk_ordem_servico_veiculo";

alter table "public"."ordemservico" add constraint "ordemservico_alvo_consistente" CHECK ((((alvo_tipo = 'VEICULO'::public.enum_alvo_reparo) AND (veiculoid IS NOT NULL) AND (pecaid IS NULL)) OR ((alvo_tipo = 'PECA'::public.enum_alvo_reparo) AND (pecaid IS NOT NULL) AND (veiculoid IS NULL)))) not valid;

alter table "public"."ordemservico" validate constraint "ordemservico_alvo_consistente";

alter table "public"."ordemservico" add constraint "ordemservico_checklist_modelo_id_fkey" FOREIGN KEY (checklist_modelo_id) REFERENCES public.checklist_modelo(id) not valid;

alter table "public"."ordemservico" validate constraint "ordemservico_checklist_modelo_id_fkey";

alter table "public"."ordemservico" add constraint "ordemservico_created_by_fkey" FOREIGN KEY (created_by) REFERENCES public.usuario(id) not valid;

alter table "public"."ordemservico" validate constraint "ordemservico_created_by_fkey";

alter table "public"."ordemservico" add constraint "ordemservico_deleted_by_fkey" FOREIGN KEY (deleted_by) REFERENCES public.usuario(id) not valid;

alter table "public"."ordemservico" validate constraint "ordemservico_deleted_by_fkey";

alter table "public"."ordemservico" add constraint "ordemservico_pecaid_fkey" FOREIGN KEY (pecaid) REFERENCES public.peca(id) not valid;

alter table "public"."ordemservico" validate constraint "ordemservico_pecaid_fkey";

alter table "public"."ordemservico" add constraint "ordemservico_updated_by_fkey" FOREIGN KEY (updated_by) REFERENCES public.usuario(id) not valid;

alter table "public"."ordemservico" validate constraint "ordemservico_updated_by_fkey";

alter table "public"."osaprovacao" add constraint "osaprovacao_aprovador_usuario_id_fkey" FOREIGN KEY (aprovador_usuario_id) REFERENCES public.usuario(id) not valid;

alter table "public"."osaprovacao" validate constraint "osaprovacao_aprovador_usuario_id_fkey";

alter table "public"."osaprovacao" add constraint "osaprovacao_ordemservicoid_fkey" FOREIGN KEY (ordemservicoid) REFERENCES public.ordemservico(id) ON DELETE CASCADE not valid;

alter table "public"."osaprovacao" validate constraint "osaprovacao_ordemservicoid_fkey";

alter table "public"."osaprovacao" add constraint "osaprovacao_token_key" UNIQUE using index "osaprovacao_token_key";

alter table "public"."osproduto" add constraint "fk_os_produto_produto" FOREIGN KEY (produtoid) REFERENCES public.produto(id) not valid;

alter table "public"."osproduto" validate constraint "fk_os_produto_produto";

alter table "public"."osproduto" add constraint "osproduto_ordemservicoid_fkey" FOREIGN KEY (ordemservicoid) REFERENCES public.ordemservico(id) ON DELETE CASCADE not valid;

alter table "public"."osproduto" validate constraint "osproduto_ordemservicoid_fkey";

alter table "public"."osproduto_baixa" add constraint "osproduto_baixa_ordemservicoid_fkey" FOREIGN KEY (ordemservicoid) REFERENCES public.ordemservico(id) ON DELETE CASCADE not valid;

alter table "public"."osproduto_baixa" validate constraint "osproduto_baixa_ordemservicoid_fkey";

alter table "public"."osproduto_baixa" add constraint "osproduto_baixa_produtoid_fkey" FOREIGN KEY (produtoid) REFERENCES public.produto(id) not valid;

alter table "public"."osproduto_baixa" validate constraint "osproduto_baixa_produtoid_fkey";

alter table "public"."osservico" add constraint "fk_os_servico_ordem" FOREIGN KEY (ordemservicoid) REFERENCES public.ordemservico(id) not valid;

alter table "public"."osservico" validate constraint "fk_os_servico_ordem";

alter table "public"."osservico" add constraint "fk_os_servico_servico" FOREIGN KEY (servicoid) REFERENCES public.servico(id) not valid;

alter table "public"."osservico" validate constraint "fk_os_servico_servico";

alter table "public"."osservico" add constraint "osservico_idusuariorealizador_fkey" FOREIGN KEY (idusuariorealizador) REFERENCES public.usuario(id) ON UPDATE CASCADE not valid;

alter table "public"."osservico" validate constraint "osservico_idusuariorealizador_fkey";

alter table "public"."pagamento" add constraint "pagamento_ordemservicoid_fkey" FOREIGN KEY (ordemservicoid) REFERENCES public.ordemservico(id) not valid;

alter table "public"."pagamento" validate constraint "pagamento_ordemservicoid_fkey";

alter table "public"."pagamento_config" add constraint "pagamento_config_empresa_id_fkey" FOREIGN KEY (empresa_id) REFERENCES public.empresa(id) ON DELETE CASCADE not valid;

alter table "public"."pagamento_config" validate constraint "pagamento_config_empresa_id_fkey";

alter table "public"."pagamento_evento" add constraint "pagamento_evento_pagamentoid_fkey" FOREIGN KEY (pagamentoid) REFERENCES public.pagamento(id) not valid;

alter table "public"."pagamento_evento" validate constraint "pagamento_evento_pagamentoid_fkey";

alter table "public"."peca" add constraint "peca_clienteid_fkey" FOREIGN KEY (clienteid) REFERENCES public.cliente(id) not valid;

alter table "public"."peca" validate constraint "peca_clienteid_fkey";

alter table "public"."peca" add constraint "peca_veiculoid_fkey" FOREIGN KEY (veiculoid) REFERENCES public.veiculo(id) not valid;

alter table "public"."peca" validate constraint "peca_veiculoid_fkey";

alter table "public"."perfil" add constraint "perfil_nome_key" UNIQUE using index "perfil_nome_key";

alter table "public"."perfilpermissao" add constraint "perfilpermissao_perfil_fkey" FOREIGN KEY (perfilid) REFERENCES public.perfil(id) not valid;

alter table "public"."perfilpermissao" validate constraint "perfilpermissao_perfil_fkey";

alter table "public"."perfilpermissao" add constraint "perfilpermissao_permissao_fkey" FOREIGN KEY (permissaoid) REFERENCES public.permissao(id) not valid;

alter table "public"."perfilpermissao" validate constraint "perfilpermissao_permissao_fkey";

alter table "public"."permissao" add constraint "permissao_nome_key" UNIQUE using index "permissao_nome_key";

alter table "public"."produto" add constraint "produto_created_by_fkey" FOREIGN KEY (created_by) REFERENCES public.usuario(id) not valid;

alter table "public"."produto" validate constraint "produto_created_by_fkey";

alter table "public"."produto" add constraint "produto_deleted_by_fkey" FOREIGN KEY (deleted_by) REFERENCES public.usuario(id) not valid;

alter table "public"."produto" validate constraint "produto_deleted_by_fkey";

alter table "public"."produto" add constraint "produto_grupo_produto_id_fkey" FOREIGN KEY (grupo_produto_id) REFERENCES public.produtogrupo(id) ON UPDATE CASCADE not valid;

alter table "public"."produto" validate constraint "produto_grupo_produto_id_fkey";

alter table "public"."produto" add constraint "produto_tipo_unidade_id_fkey" FOREIGN KEY (tipo_unidade_id) REFERENCES public.unidademedida(id) ON UPDATE CASCADE not valid;

alter table "public"."produto" validate constraint "produto_tipo_unidade_id_fkey";

alter table "public"."produto" add constraint "produto_updated_by_fkey" FOREIGN KEY (updated_by) REFERENCES public.usuario(id) not valid;

alter table "public"."produto" validate constraint "produto_updated_by_fkey";

alter table "public"."produto_imagem" add constraint "produto_imagem_produto_id_fkey" FOREIGN KEY (produto_id) REFERENCES public.produto(id) ON DELETE CASCADE not valid;

alter table "public"."produto_imagem" validate constraint "produto_imagem_produto_id_fkey";

alter table "public"."produtoentrada" add constraint "produtoentrada_fornecedorid_fkey" FOREIGN KEY (fornecedorid) REFERENCES public.fornecedor(id) not valid;

alter table "public"."produtoentrada" validate constraint "produtoentrada_fornecedorid_fkey";

alter table "public"."produtoentrada" add constraint "produtoentrada_produtoid_fkey" FOREIGN KEY (produtoid) REFERENCES public.produto(id) not valid;

alter table "public"."produtoentrada" validate constraint "produtoentrada_produtoid_fkey";

alter table "public"."servico" add constraint "fk_servico_tipo_servico" FOREIGN KEY (tiposervicoid) REFERENCES public.tiposervico(id) not valid;

alter table "public"."servico" validate constraint "fk_servico_tipo_servico";

alter table "public"."servico" add constraint "servico_codigo_key" UNIQUE using index "servico_codigo_key";

alter table "public"."tiposervico" add constraint "fk_tipo_servico_categoria" FOREIGN KEY (categoriaid) REFERENCES public.categoriaservico(id) not valid;

alter table "public"."tiposervico" validate constraint "fk_tipo_servico_categoria";

alter table "public"."transacao" add constraint "transacao_banco_id_fkey" FOREIGN KEY (banco_id) REFERENCES public.bancoconta(id) ON UPDATE RESTRICT not valid;

alter table "public"."transacao" validate constraint "transacao_banco_id_fkey";

alter table "public"."transacao" add constraint "transacao_cliente_id_fkey" FOREIGN KEY (cliente_id) REFERENCES public.cliente(id) ON UPDATE CASCADE not valid;

alter table "public"."transacao" validate constraint "transacao_cliente_id_fkey";

alter table "public"."transacao" add constraint "transacao_created_by_fkey" FOREIGN KEY (created_by) REFERENCES public.usuario(id) not valid;

alter table "public"."transacao" validate constraint "transacao_created_by_fkey";

alter table "public"."transacao" add constraint "transacao_deleted_by_fkey" FOREIGN KEY (deleted_by) REFERENCES public.usuario(id) not valid;

alter table "public"."transacao" validate constraint "transacao_deleted_by_fkey";

alter table "public"."transacao" add constraint "transacao_ordemservicoid_fkey" FOREIGN KEY (ordemservicoid) REFERENCES public.ordemservico(id) ON DELETE SET NULL not valid;

alter table "public"."transacao" validate constraint "transacao_ordemservicoid_fkey";

alter table "public"."transacao" add constraint "transacao_updated_by_fkey" FOREIGN KEY (updated_by) REFERENCES public.usuario(id) not valid;

alter table "public"."transacao" validate constraint "transacao_updated_by_fkey";

alter table "public"."transacao" add constraint "transacao_vendaid_fkey" FOREIGN KEY (vendaid) REFERENCES public.venda(id) ON DELETE CASCADE not valid;

alter table "public"."transacao" validate constraint "transacao_vendaid_fkey";

alter table "public"."transferencias_veiculos" add constraint "transferencias_veiculos_created_by_fkey" FOREIGN KEY (created_by) REFERENCES public.usuario(id) not valid;

alter table "public"."transferencias_veiculos" validate constraint "transferencias_veiculos_created_by_fkey";

alter table "public"."transferencias_veiculos" add constraint "transferencias_veiculos_dono_anteior_fkey" FOREIGN KEY (dono_anteior) REFERENCES public.cliente(id) not valid;

alter table "public"."transferencias_veiculos" validate constraint "transferencias_veiculos_dono_anteior_fkey";

alter table "public"."transferencias_veiculos" add constraint "transferencias_veiculos_novo_dono_fkey" FOREIGN KEY (novo_dono) REFERENCES public.cliente(id) not valid;

alter table "public"."transferencias_veiculos" validate constraint "transferencias_veiculos_novo_dono_fkey";

alter table "public"."transferencias_veiculos" add constraint "transferencias_veiculos_veiculo_id_fkey" FOREIGN KEY (veiculo_id) REFERENCES public.veiculo(id) ON DELETE CASCADE not valid;

alter table "public"."transferencias_veiculos" validate constraint "transferencias_veiculos_veiculo_id_fkey";

alter table "public"."unidademedida" add constraint "unidademedida_sigla_key" UNIQUE using index "unidademedida_sigla_key";

alter table "public"."usuario" add constraint "usuario_auth_fkey" FOREIGN KEY (id) REFERENCES auth.users(id) ON DELETE CASCADE not valid;

alter table "public"."usuario" validate constraint "usuario_auth_fkey";

alter table "public"."usuario" add constraint "usuario_email_key" UNIQUE using index "usuario_email_key";

alter table "public"."usuario" add constraint "usuario_perfilid_fkey" FOREIGN KEY (perfilid) REFERENCES public.perfil(id) not valid;

alter table "public"."usuario" validate constraint "usuario_perfilid_fkey";

alter table "public"."usuario" add constraint "usuario_setorid_fkey" FOREIGN KEY (setorid) REFERENCES public.setor(id) not valid;

alter table "public"."usuario" validate constraint "usuario_setorid_fkey";

alter table "public"."veiculo" add constraint "fk_veiculo_cliente" FOREIGN KEY (clienteid) REFERENCES public.cliente(id) ON DELETE CASCADE not valid;

alter table "public"."veiculo" validate constraint "fk_veiculo_cliente";

alter table "public"."veiculo" add constraint "veiculo_placa_formatada_key" UNIQUE using index "veiculo_placa_formatada_key";

alter table "public"."veiculo" add constraint "veiculo_placa_formato_chk" CHECK ((((placa)::text ~ '^[A-Z]{3}[0-9]{4}$'::text) OR ((placa)::text ~ '^[A-Z]{3}[0-9][A-Z0-9][0-9]{2}$'::text))) not valid;

alter table "public"."veiculo" validate constraint "veiculo_placa_formato_chk";

alter table "public"."veiculo" add constraint "veiculo_placa_key" UNIQUE using index "veiculo_placa_key";

alter table "public"."venda" add constraint "fk_venda_online_cliente" FOREIGN KEY (clienteid) REFERENCES public.cliente(id) not valid;

alter table "public"."venda" validate constraint "fk_venda_online_cliente";

alter table "public"."venda" add constraint "venda_created_by_fkey" FOREIGN KEY (created_by) REFERENCES public.usuario(id) not valid;

alter table "public"."venda" validate constraint "venda_created_by_fkey";

alter table "public"."vendaproduto" add constraint "vendaproduto_produtoid_fkey" FOREIGN KEY (produtoid) REFERENCES public.produto(id) not valid;

alter table "public"."vendaproduto" validate constraint "vendaproduto_produtoid_fkey";

alter table "public"."vendaproduto" add constraint "vendaproduto_venda_id_fkey" FOREIGN KEY (venda_id) REFERENCES public.venda(id) ON DELETE CASCADE not valid;

alter table "public"."vendaproduto" validate constraint "vendaproduto_venda_id_fkey";

set check_function_bodies = off;

CREATE OR REPLACE FUNCTION public.atualizar_totais_nfe(p_nfe_id bigint)
 RETURNS void
 LANGUAGE sql
AS $function$
  update nfe
  set
    total_produtos = coalesce((
      select sum(ni.valor_total)
      from nfe_item ni
      where ni.nfe_id = nfe.id
    ), 0),
    total_nfe = coalesce((
      select sum(ni.valor_total)
      from nfe_item ni
      where ni.nfe_id = nfe.id
    ), 0),
    updatedat = now()
  where id = p_nfe_id;
$function$
;

CREATE OR REPLACE FUNCTION public.criar_nfe_de_os(p_ordemservicoid integer)
 RETURNS bigint
 LANGUAGE plpgsql
AS $function$DECLARE
  v_nfe_id      bigint;
  v_numero      int;
  v_serie       int;
  v_modelo      public.enum_modelo_nfe;
  v_ambiente    public.enum_ambiente_nfe;
  v_chave       char(44);
  v_dataemissao timestamptz := now();
  v_cod_uf      text;
  v_cnpj_emit   text;
  v_ano         text;
  v_mes         text;
  v_mod         text;
  v_serie_str   text;
  v_numero_str  text;
  v_tp_emis     text;
  v_cod_nf      text;
  v_cdv         text;

  -- por enquanto fixo; depois voc√™ pode amarrar a empresa da OS
  v_empresaid   bigint := 1;

  v_cfg         nfe_config%ROWTYPE;
  v_emp         empresa%ROWTYPE;
BEGIN
  --------------------------------------------------------------------
  -- 1) Validar se a OS existe
  --------------------------------------------------------------------
  IF NOT EXISTS (SELECT 1 FROM ordemservico WHERE id = p_ordemservicoid) THEN
    RAISE EXCEPTION 'OS % n√£o encontrada', p_ordemservicoid;
  END IF;

  --------------------------------------------------------------------
  -- 2) Carregar EMPRESA e NFE_CONFIG da empresa
  --------------------------------------------------------------------
  SELECT *
    INTO v_emp
  FROM empresa
  WHERE id = v_empresaid;

  IF NOT FOUND THEN
    RAISE EXCEPTION 'Empresa % n√£o encontrada na tabela EMPRESA', v_empresaid;
  END IF;

  SELECT *
    INTO v_cfg
  FROM nfe_config
  WHERE empresaid = v_empresaid;

  IF NOT FOUND THEN
    RAISE EXCEPTION 'Configura√ß√£o de NF-e (nfe_config) n√£o encontrada para empresa %', v_empresaid;
  END IF;

  --------------------------------------------------------------------
  -- 3) Puxar par√¢metros da config
  --------------------------------------------------------------------
  v_modelo   := v_cfg.modelo;
  v_serie    := v_cfg.serie;
  v_ambiente := v_cfg.ambiente;
  v_tp_emis  := v_cfg.tp_emis::text;   -- tp_emis √© smallint na config

  -- cUF = 2 primeiros d√≠gitos do c√≥digo do munic√≠pio
  v_cod_uf := substring(coalesce(v_emp.codigomunicipio, '') FROM 1 FOR 2);

  IF v_cod_uf IS NULL OR length(v_cod_uf) <> 2 THEN
    RAISE EXCEPTION 'C√≥digo de munic√≠pio inv√°lido para empresa % (codigomunicipio=%)',
      v_empresaid, v_emp.codigomunicipio;
  END IF;

  -- CNPJ somente n√∫meros
  v_cnpj_emit := regexp_replace(coalesce(v_emp.cnpj, ''), '\D', '', 'g');

  IF length(v_cnpj_emit) <> 14 THEN
    RAISE EXCEPTION 'CNPJ da empresa % inv√°lido (%). Deve ter 14 d√≠gitos num√©ricos.',
      v_empresaid, v_emp.cnpj;
  END IF;

  v_ano := to_char(v_dataemissao, 'YY');
  v_mes := to_char(v_dataemissao, 'MM');
  v_mod := '55';  -- NF-e

  --------------------------------------------------------------------
  -- 4) Descobrir pr√≥ximo n√∫mero da NF-e a partir do nfe_config
  --    (ultimo_numero + 1)
  --------------------------------------------------------------------
  v_numero := v_cfg.ultimo_numero + 1;

  v_serie_str  := lpad(v_serie::text, 3, '0');
  v_numero_str := lpad(v_numero::text, 9, '0');

  --------------------------------------------------------------------
  -- 5) Gerar cNF (8 d√≠gitos) aleat√≥rio
  --------------------------------------------------------------------
  v_cod_nf := lpad((floor(random() * 99999999))::int::text, 8, '0');

  --------------------------------------------------------------------
  -- 6) Montar chave de acesso SEM o DV
  --    cUF(2) + AAMM(4) + CNPJ(14) + mod(2) + s√©rie(3)
  --    + nNF(9) + tpEmis(1) + cNF(8)
  --------------------------------------------------------------------
  v_chave :=
    (v_cod_uf || v_ano || v_mes || v_cnpj_emit || v_mod ||
     v_serie_str || v_numero_str || v_tp_emis || v_cod_nf);

  --------------------------------------------------------------------
  -- 7) Calcular d√≠gito verificador (m√≥dulo 11)
  --------------------------------------------------------------------
  DECLARE
    soma int := 0;
    peso int := 2;
    i    int;
    dig  int;
    ch_sem_dv text := v_chave;
  BEGIN
    FOR i IN REVERSE length(ch_sem_dv)..1 LOOP
      soma := soma + (substr(ch_sem_dv, i, 1)::int * peso);
      peso := peso + 1;
      IF peso > 9 THEN
        peso := 2;
      END IF;
    END LOOP;

    dig := 11 - (soma % 11);

    -- mant√©m a mesma regra que voc√™ j√° estava usando
    IF dig = 0 OR dig = 1 THEN
      dig := 0;
    END IF;

    v_cdv := dig::text;
  END;

  v_chave := v_chave || v_cdv;

  --------------------------------------------------------------------
  -- 8) Inserir na tabela NFE (RASCUNHO)
  --------------------------------------------------------------------
  INSERT INTO nfe (
    modelo,
    serie,
    numero,
    chave_acesso,
    ambiente,
    status,
    ordemservicoid,
    vendaid,
    clienteid,
    empresaid,
    dataemissao,
    total_produtos,
    total_servicos,
    total_nfe,
    xml_assinado,
    xml_autorizado
  )
  SELECT
    v_modelo,
    v_serie,
    v_numero,
    v_chave,
    v_ambiente,
    'RASCUNHO',
    os.id,
    NULL,
    os.clienteid,
    v_empresaid,          -- antes era 3 fixo
    v_dataemissao,
    0,
    0,
    0,
    NULL,
    NULL
  FROM ordemservico os
  WHERE os.id = p_ordemservicoid
  RETURNING id INTO v_nfe_id;

  --------------------------------------------------------------------
  -- 9) Atualizar nfe_config.ultimo_numero
  --------------------------------------------------------------------
  UPDATE nfe_config
     SET ultimo_numero = v_numero,
         updatedat     = now()
   WHERE id = v_cfg.id;

  RETURN v_nfe_id;
END;$function$
;

CREATE OR REPLACE FUNCTION public.criar_nfe_de_venda(p_vendaid integer)
 RETURNS bigint
 LANGUAGE plpgsql
 SECURITY DEFINER
AS $function$declare
  v_nfe_id      bigint;
  v_numero      int;
  v_serie       int;
  v_modelo      public.enum_modelo_nfe;
  v_ambiente    public.enum_ambiente_nfe;
  v_chave       char(44);
  v_dataemissao timestamptz := now();
  v_cod_uf      text;
  v_cnpj_emit   text;
  v_ano         text;
  v_mes         text;
  v_mod         text;
  v_serie_str   text;
  v_numero_str  text;
  v_tp_emis     text;
  v_cod_nf      text;
  v_cdv         text;

  -- por enquanto fixo; voc√™ pode amarrar depois
  v_empresaid   bigint := 1;

  v_cfg         public.nfe_config%rowtype;
  v_emp         public.empresa%rowtype;
  v_venda       public.venda%rowtype;
begin
  -- 1) Validar se a VENDA existe
  select * into v_venda
  from public.venda
  where id = p_vendaid;

  if not found then
    raise exception 'Venda % n√£o encontrada', p_vendaid;
  end if;

  -- 2) Carregar EMPRESA e NFE_CONFIG
  select * into v_emp
  from public.empresa
  where id = v_empresaid;

  if not found then
    raise exception 'Empresa % n√£o encontrada na tabela EMPRESA', v_empresaid;
  end if;

  select * into v_cfg
  from public.nfe_config
  where empresaid = v_empresaid;

  if not found then
    raise exception 'Configura√ß√£o de NF-e (nfe_config) n√£o encontrada para empresa %', v_empresaid;
  end if;

  -- 3) Puxar par√¢metros da config
  v_modelo   := v_cfg.modelo;
  v_serie    := v_cfg.serie;
  v_ambiente := v_cfg.ambiente;
  v_tp_emis  := v_cfg.tp_emis::text;

  -- cUF = 2 primeiros d√≠gitos do c√≥digo do munic√≠pio
  v_cod_uf := substring(coalesce(v_emp.codigomunicipio, '') from 1 for 2);

  if v_cod_uf is null or length(v_cod_uf) <> 2 then
    raise exception 'C√≥digo de munic√≠pio inv√°lido para empresa % (codigomunicipio=%)',
      v_empresaid, v_emp.codigomunicipio;
  end if;

  -- CNPJ somente n√∫meros
  v_cnpj_emit := regexp_replace(coalesce(v_emp.cnpj, ''), '\D', '', 'g');

  if length(v_cnpj_emit) <> 14 then
    raise exception 'CNPJ da empresa % inv√°lido (%). Deve ter 14 d√≠gitos num√©ricos.',
      v_empresaid, v_emp.cnpj;
  end if;

  v_ano := to_char(v_dataemissao, 'YY');
  v_mes := to_char(v_dataemissao, 'MM');
  v_mod := '55';

  -- 4) Pr√≥ximo n√∫mero (ultimo_numero + 1)
  v_numero := v_cfg.ultimo_numero + 1;

  v_serie_str  := lpad(v_serie::text, 3, '0');
  v_numero_str := lpad(v_numero::text, 9, '0');

  -- 5) cNF (8 d√≠gitos)
  v_cod_nf := lpad((floor(random() * 99999999))::int::text, 8, '0');

  -- 6) chave sem DV
  v_chave :=
    (v_cod_uf || v_ano || v_mes || v_cnpj_emit || v_mod ||
     v_serie_str || v_numero_str || v_tp_emis || v_cod_nf);

  -- 7) DV (m√≥dulo 11)
  declare
    soma int := 0;
    peso int := 2;
    i    int;
    dig  int;
    ch_sem_dv text := v_chave;
  begin
    for i in reverse length(ch_sem_dv)..1 loop
      soma := soma + (substr(ch_sem_dv, i, 1)::int * peso);
      peso := peso + 1;
      if peso > 9 then
        peso := 2;
      end if;
    end loop;

    dig := 11 - (soma % 11);

    if dig = 0 or dig = 1 then
      dig := 0;
    end if;

    v_cdv := dig::text;
  end;

  v_chave := v_chave || v_cdv;

  -- 8) Inserir NFE (RASCUNHO) vinculada √† VENDA
  insert into public.nfe (
    modelo,
    serie,
    numero,
    chave_acesso,
    ambiente,
    status,
    ordemservicoid,
    vendaid,
    clienteid,
    empresaid,
    dataemissao,
    total_produtos,
    total_servicos,
    total_nfe,
    xml_assinado,
    xml_autorizado
  )
  values (
    v_modelo,
    v_serie,
    v_numero,
    v_chave,
    v_ambiente,
    'RASCUNHO',
    null,
    v_venda.id,
    v_venda.clienteid,
    v_empresaid,
    v_dataemissao,
    0,
    0,
    0,
    null,
    null
  )
  returning id into v_nfe_id;

  -- 9) Atualizar nfe_config.ultimo_numero
  update public.nfe_config
     set ultimo_numero = v_numero,
         updatedat     = now()
   where id = v_cfg.id;

  return v_nfe_id;
end;$function$
;

CREATE OR REPLACE FUNCTION public.estornar_baixa_estoque_os(p_os_id integer)
 RETURNS void
 LANGUAGE plpgsql
AS $function$
begin
  -- devolve tudo que foi baixado
  update public.produto p
     set estoque = p.estoque + b.quantidade
    from public.osproduto_baixa b
   where b.ordemservicoid = p_os_id
     and p.id = b.produtoid;

  delete from public.osproduto_baixa
   where ordemservicoid = p_os_id;
end
$function$
;

CREATE OR REPLACE FUNCTION public.fn_baixa_estoque_produto(p_produto_id integer, p_quantidade integer)
 RETURNS void
 LANGUAGE plpgsql
 SECURITY DEFINER
AS $function$
declare
  v_estoque integer;
begin
  -- quantidade inv√°lida: n√£o faz nada
  if p_quantidade is null or p_quantidade <= 0 then
    return;
  end if;

  -- trava a linha para evitar corrida de concorr√™ncia
  select estoque
    into v_estoque
  from produto
  where id = p_produto_id
  for update;

  if v_estoque is null then
    raise exception 'Produto % n√£o encontrado para baixa de estoque.', p_produto_id
      using errcode = 'P0001';
  end if;

  if v_estoque < p_quantidade then
    raise exception 'Estoque insuficiente para produto %, em estoque: %, necess√°rio: %',
      p_produto_id, v_estoque, p_quantidade
      using errcode = 'P0001';
  end if;

  update produto
    set estoque = estoque - p_quantidade,
        updatedat = now()
  where id = p_produto_id;
end;
$function$
;

CREATE OR REPLACE FUNCTION public.fn_criar_venda_com_itens(p_venda jsonb)
 RETURNS integer
 LANGUAGE plpgsql
 SECURITY DEFINER
AS $function$declare
  v_cliente_id integer;
  v_created_by uuid;
  v_status public.enum_status_venda;
  v_desconto_tipo public.enum_tipo_desconto_venda;
  v_desconto_valor numeric;
  v_sub_total numeric;
  v_valor_total numeric;
  v_data_venda timestamp; -- ou timestamptz se sua coluna for assim

  v_venda_id integer;

  v_itens jsonb;
  v_item jsonb;
  v_produto_id integer;
  v_quantidade integer;
  v_item_sub_total numeric;
  v_item_valor_total numeric;
  v_item_valor_desconto numeric;
  v_item_tipo_desconto public.enum_tipo_desconto_venda;
begin
  -- Campos obrigat√≥rios
  v_cliente_id := (p_venda->>'clienteId')::integer;
  v_created_by := (p_venda->>'created_by')::uuid;
  v_status := (p_venda->>'status')::public.enum_status_venda;
  v_sub_total := (p_venda->>'subTotal')::numeric;
  v_valor_total := (p_venda->>'valorTotal')::numeric;
  v_data_venda := nullif(p_venda->>'dataVenda', '')::timestamp;

  if v_cliente_id is null
     or v_created_by is null
     or v_status is null
     or v_sub_total is null
     or v_valor_total is null then
    raise exception 'Campos obrigat√≥rios ausentes em p_venda (clienteId, created_by, status, subTotal, valorTotal).'
      using errcode = 'P0001';
  end if;

  -- Campos opcionais
  if p_venda ? 'descontoTipo' then
    v_desconto_tipo := nullif(p_venda->>'descontoTipo', '')::public.enum_tipo_desconto_venda;
  end if;

  if p_venda ? 'descontoValor' then
    v_desconto_valor := nullif(p_venda->>'descontoValor', '')::numeric;
  end if;

  -- Itens
  v_itens := p_venda->'itens';

  if v_itens is null or jsonb_typeof(v_itens) <> 'array' then
    raise exception 'p_venda.itens deve ser um array JSON.'
      using errcode = 'P0001';
  end if;

  if jsonb_array_length(v_itens) = 0 then
    raise exception 'p_venda.itens n√£o pode ser vazio.'
      using errcode = 'P0001';
  end if;

  -- 1) Para cada item: valida√ß√£o b√°sica + baixa de estoque (chamada √† fn_baixa_estoque_produto)
  for v_item in
    select value
    from jsonb_array_elements(v_itens) as t(value)
  loop
    v_produto_id := (v_item->>'produtoId')::integer;
    v_quantidade := (v_item->>'quantidade')::integer;

    if v_produto_id is null or v_quantidade is null or v_quantidade <= 0 then
      raise exception 'Cada item deve possuir produtoId e quantidade > 0.'
        using errcode = 'P0001';
    end if;

    -- D√° baixa no estoque (valida e atualiza)
    perform public.fn_baixa_estoque_produto(v_produto_id, v_quantidade);
  end loop;

  -- 2) Cria a venda
  insert into public.venda (
    clienteid,
    created_by,
    status,
    sub_total,
    valortotal,
    desconto_tipo,
    desconto_valor,
    datavenda
  ) values (
    v_cliente_id,
    v_created_by,
    v_status,
    v_sub_total,
    v_valor_total,
    v_desconto_tipo,
    v_desconto_valor,
    coalesce(v_data_venda, now())
  )
  returning id into v_venda_id;

  -- 3) Cria os itens (vendaproduto)
  for v_item in
    select value
    from jsonb_array_elements(v_itens) as t(value)
  loop
    v_produto_id := (v_item->>'produtoId')::integer;
    v_quantidade := (v_item->>'quantidade')::integer;
    v_item_sub_total := (v_item->>'subTotal')::numeric;
    v_item_valor_total := (v_item->>'valorTotal')::numeric;

    if v_item->>'valorDesconto' is not null then
      v_item_valor_desconto := (v_item->>'valorDesconto')::numeric;
    else
      v_item_valor_desconto := null;
    end if;

    if v_item->>'tipoDesconto' is not null then
      v_item_tipo_desconto := (v_item->>'tipoDesconto')::public.enum_tipo_desconto_venda;
    else
      v_item_tipo_desconto := null;
    end if;

    insert into public.vendaproduto (
      venda_id,
      produtoid,
      quantidade,
      sub_total,
      valor_total,
      valor_desconto,
      tipo_desconto
    ) values (
      v_venda_id,
      v_produto_id,
      v_quantidade,
      v_item_sub_total,
      v_item_valor_total,
      v_item_valor_desconto,
      v_item_tipo_desconto
    );
  end loop;

  return v_venda_id;
end;$function$
;

CREATE OR REPLACE FUNCTION public.fn_fill_titulo_marketplace()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$begin
  if new."tituloMarketplace" is null
     or btrim(new."tituloMarketplace") = '' then
    new."tituloMarketplace" := new.titulo;
  end if;

  return new;
end;$function$
;

CREATE OR REPLACE FUNCTION public.fn_os_execucao_set_times()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
begin
  -- Quando entra em EM_ANDAMENTO, marca in√≠cio (s√≥ se ainda n√£o tiver)
  if (new.status::text = 'EM_ANDAMENTO' and old.status is distinct from new.status) then
    new.execucao_inicio_em := coalesce(old.execucao_inicio_em, now());
    new.execucao_fim_em := null; -- se voltar para andamento, reabre a execu√ß√£o
  end if;

  -- Quando entra em PAGAMENTO, marca fim (s√≥ se tiver in√≠cio e ainda n√£o tiver fim)
  if (new.status::text = 'PAGAMENTO' and old.status is distinct from new.status) then
    if (old.execucao_inicio_em is not null) then
      new.execucao_inicio_em := old.execucao_inicio_em;
      new.execucao_fim_em := coalesce(old.execucao_fim_em, now());
    end if;
  end if;

  return new;
end;
$function$
;

CREATE OR REPLACE FUNCTION public.fn_set_status_estoque()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$begin
  new.status_estoque :=
    case
      when new.estoque <= 0 then 'SEM_ESTOQUE'
      when new.estoque <= (new.estoqueminimo / 2) then 'CRITICO'
      when new.estoque <= new.estoqueminimo then 'BAIXO'
      else 'OK'
    end;
  return new;
end;$function$
;

CREATE OR REPLACE FUNCTION public.fn_set_titulo_marketplace_product()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$begin
  new.tituloMarketplace :=
    case
      when new.tituloMarketplace = '' then new.titulo
    end;
  return new;
end;$function$
;

CREATE OR REPLACE FUNCTION public.handle_new_auth_user()
 RETURNS trigger
 LANGUAGE plpgsql
 SECURITY DEFINER
 SET search_path TO 'public'
AS $function$
begin
  insert into public.usuario (id, email, nome, perfilid, setorid, createdat, updatedat)
  values (
    new.id,
    new.email,
    coalesce(new.raw_user_meta_data->>'nome', new.email),
    nullif(new.raw_user_meta_data->>'perfilid','')::int,
    nullif(new.raw_user_meta_data->>'setorid','')::int,
    now(),
    now()
  )
  on conflict (id) do update
    set email     = excluded.email,
        nome      = coalesce(excluded.nome, public.usuario.nome),
        perfilid  = coalesce(excluded.perfilid, public.usuario.perfilid),
        setorid   = coalesce(excluded.setorid, public.usuario.setorid),
        updatedat = now();

  return new;
end;
$function$
;

CREATE OR REPLACE FUNCTION public.handle_update_auth_user_email()
 RETURNS trigger
 LANGUAGE plpgsql
 SECURITY DEFINER
 SET search_path TO 'public'
AS $function$
begin
  if new.email is distinct from old.email then
    update public.usuario
       set email = new.email,
           updatedat = now()
     where id = new.id;
  end if;
  return new;
end;
$function$
;

CREATE OR REPLACE FUNCTION public.normalize_placa()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
begin
  new.placa := upper(regexp_replace(new.placa, '[^A-Za-z0-9]', '', 'g'));
  return new;
end;
$function$
;

CREATE OR REPLACE FUNCTION public.preencher_itens_nfe_de_os(p_nfe_id bigint)
 RETURNS void
 LANGUAGE plpgsql
AS $function$
declare
  v_nfe record;
begin
  --------------------------------------------------------------------
  -- 1) Verifica se a NF-e existe e est√° vinculada a uma OS
  --------------------------------------------------------------------
  select *
    into v_nfe
  from nfe
  where id = p_nfe_id;

  if not found then
    raise exception 'NF-e % n√£o encontrada na tabela nfe', p_nfe_id;
  end if;

  if v_nfe.ordemservicoid is null then
    raise exception
      'NF-e % n√£o est√° vinculada a uma ordem de servi√ßo (ordemservicoid nulo).',
      p_nfe_id;
  end if;

  --------------------------------------------------------------------
  -- 2) Remove itens anteriores da NF-e (se houver) para recriar do zero
  --------------------------------------------------------------------
  delete from nfe_item
  where nfe_id = p_nfe_id;

  --------------------------------------------------------------------
  -- 3) Insere itens da OS (osproduto) na nfe_item,
  --    herdando ICMS, PIS e COFINS do produto.
  --------------------------------------------------------------------
  insert into nfe_item (
    nfe_id,
    n_item,
    produtoid,
    descricao,
    ncm,
    cfop,
    csosn,
    cest,
    unidade,
    quantidade,
    valor_unitario,
    valor_total,
    valor_desconto,
    aliquotaicms,
    valor_bc_icms,
    valor_icms,
    cst_pis,
    aliquota_pis,
    valor_pis,
    cst_cofins,
    aliquota_cofins,
    valor_cofins,
    cst
  )
  select
    n.id as nfe_id,
    row_number() over (order by op.produtoid) as n_item,

    -- identifica√ß√£o do produto
    p.id as produtoid,
    coalesce(p.titulo, p.descricao) as descricao,
    p.ncm,
    coalesce(p.cfop, '5102') as cfop,
    p.csosn,
    p.cest,
    p.unidade,

    -- quantidade e valores
    op.quantidade::numeric(14,4)      as quantidade,
    op.precounitario::numeric(14,10)  as valor_unitario,
    op.subtotal::numeric(14,2)        as valor_total,
    0::numeric(14,2)                  as valor_desconto,

    -- ICMS
    p.aliquotaicms,
    op.subtotal::numeric(14,2) as valor_bc_icms,
    (
      op.subtotal
      * coalesce(p.aliquotaicms, 0) / 100
    )::numeric(14,2) as valor_icms,

    -- PIS (herdado do produto; default para 07/0,00 se n√£o preenchido)
    coalesce(p.cst_pis, '07')                       as cst_pis,
    coalesce(p.aliquota_pis, 0)::numeric(5,2)       as aliquota_pis,
    0::numeric(14,2)                                as valor_pis,   -- se quiser, pode calcular depois

    -- COFINS (herdado do produto; default para 07/0,00 se n√£o preenchido)
    coalesce(p.cst_cofins, '07')                    as cst_cofins,
    coalesce(p.aliquota_cofins, 0)::numeric(5,2)    as aliquota_cofins,
    0::numeric(14,2)                                as valor_cofins, -- idem

    -- CST gen√©rico de ICMS (espelho do produto)
    p.cst
  from nfe n
  join ordemservico os on os.id = n.ordemservicoid
  join osproduto op on op.ordemservicoid = os.id
  join produto p on p.id = op.produtoid
  where n.id = p_nfe_id;

  --------------------------------------------------------------------
  -- 4) Opcional: se quiser garantir pelo menos 1 item, pode validar aqui
  --------------------------------------------------------------------
  if not exists (select 1 from nfe_item where nfe_id = p_nfe_id) then
    raise exception
      'Nenhum item foi gerado em nfe_item para a NF-e % (ordemservicoid=%).',
      p_nfe_id, v_nfe.ordemservicoid;
  end if;

end;
$function$
;

CREATE OR REPLACE FUNCTION public.preencher_itens_nfe_de_venda(p_nfe_id bigint)
 RETURNS void
 LANGUAGE plpgsql
 SECURITY DEFINER
AS $function$
declare
  v_nfe record;
begin
  -- 1) Verifica NFE e v√≠nculo com venda
  select * into v_nfe
  from public.nfe
  where id = p_nfe_id;

  if not found then
    raise exception 'NF-e % n√£o encontrada na tabela nfe', p_nfe_id;
  end if;

  if v_nfe.vendaid is null then
    raise exception 'NF-e % n√£o est√° vinculada a uma venda (vendaid nulo).', p_nfe_id;
  end if;

  -- 2) Remove itens anteriores
  delete from public.nfe_item
  where nfe_id = p_nfe_id;

  -- 3) Insere itens da VENDA (vendaproduto) na nfe_item
  insert into public.nfe_item (
    nfe_id,
    n_item,
    produtoid,
    descricao,
    ncm,
    cfop,
    csosn,
    cest,
    unidade,
    quantidade,
    valor_unitario,
    valor_total,
    valor_desconto,
    aliquotaicms,
    valor_bc_icms,
    valor_icms,
    cst_pis,
    aliquota_pis,
    valor_pis,
    cst_cofins,
    aliquota_cofins,
    valor_cofins,
    cst
  )
  select
    n.id as nfe_id,
    row_number() over (order by vp.id) as n_item,

    p.id as produtoid,
    coalesce(p.titulo, p.descricao) as descricao,
    p.ncm,
    coalesce(p.cfop, '5102') as cfop,
    p.csosn,
    p.cest,
    p.unidade,

    vp.quantidade::numeric(14,4) as quantidade,

    case
      when vp.quantidade::numeric > 0 then
        (vp.valor_total::numeric / vp.quantidade::numeric)::numeric(14,10)
      else
        vp.valor_total::numeric::numeric(14,10)
    end as valor_unitario,

    vp.valor_total::numeric(14,2) as valor_total,
    coalesce(vp.valor_desconto, 0)::numeric(14,2) as valor_desconto,

    -- ICMS
    p.aliquotaicms,
    vp.valor_total::numeric(14,2) as valor_bc_icms,
    (
      vp.valor_total::numeric
      * coalesce(p.aliquotaicms, 0) / 100
    )::numeric(14,2) as valor_icms,

    -- PIS
    coalesce(p.cst_pis, '07') as cst_pis,
    coalesce(p.aliquota_pis, 0)::numeric(5,2) as aliquota_pis,
    0::numeric(14,2) as valor_pis,

    -- COFINS
    coalesce(p.cst_cofins, '07') as cst_cofins,
    coalesce(p.aliquota_cofins, 0)::numeric(5,2) as aliquota_cofins,
    0::numeric(14,2) as valor_cofins,

    -- CST gen√©rico
    p.cst
  from public.nfe n
  join public.venda v on v.id = n.vendaid
  join public.vendaproduto vp on vp.venda_id = v.id
  join public.produto p on p.id = vp.produtoid
  where n.id = p_nfe_id;

  if not exists (select 1 from public.nfe_item where nfe_id = p_nfe_id) then
    raise exception 'Nenhum item foi gerado em nfe_item para a NF-e % (vendaid=%).',
      p_nfe_id, v_nfe.vendaid;
  end if;
end;
$function$
;

CREATE OR REPLACE FUNCTION public.reaplicar_baixa_estoque_os(p_os_id integer)
 RETURNS void
 LANGUAGE plpgsql
AS $function$
declare
  r record;
  q_baixada int;
  delta int;
begin
  -- Para cada item ATUAL do or√ßamento
  for r in
    select p.produtoid, p.quantidade
      from public.osproduto p
     where p.ordemservicoid = p_os_id
  loop
    select b.quantidade into q_baixada
      from public.osproduto_baixa b
     where b.ordemservicoid = p_os_id
       and b.produtoid = r.produtoid;

    if q_baixada is null then
      delta := r.quantidade; -- primeira baixa
    else
      delta := r.quantidade - q_baixada; -- diferen√ßa desde a √∫ltima aplica√ß√£o
    end if;

    if delta > 0 then
      -- precisa baixar mais (consumir estoque)
      update public.produto
         set estoque = estoque - delta
       where id = r.produtoid
         and estoque >= delta;
      if not found then
        raise exception 'Estoque insuficiente para o produto % (necess√°rio: %, OS %)', r.produtoid, delta, p_os_id
          using errcode = 'P0001';
      end if;

      insert into public.osproduto_baixa (ordemservicoid, produtoid, quantidade)
      values (p_os_id, r.produtoid, r.quantidade)
      on conflict (ordemservicoid, produtoid) do update
        set quantidade = excluded.quantidade;

    elsif delta < 0 then
      -- precisa devolver parte (reduziu quantidade no or√ßamento)
      update public.produto
         set estoque = estoque + (-delta)
       where id = r.produtoid;

      insert into public.osproduto_baixa (ordemservicoid, produtoid, quantidade)
      values (p_os_id, r.produtoid, r.quantidade)
      on conflict (ordemservicoid, produtoid) do update
        set quantidade = excluded.quantidade;
    end if;
  end loop;

  -- Itens que foram REMOVIDOS do or√ßamento: estorna tudo e apaga controle
  for r in
    select b.produtoid, b.quantidade
      from public.osproduto_baixa b
     where b.ordemservicoid = p_os_id
       and not exists (
         select 1 from public.osproduto p
          where p.ordemservicoid = p_os_id
            and p.produtoid = b.produtoid
       )
  loop
    update public.produto
       set estoque = estoque + r.quantidade
     where id = r.produtoid;

    delete from public.osproduto_baixa
     where ordemservicoid = p_os_id
       and produtoid      = r.produtoid;
  end loop;
end
$function$
;

CREATE OR REPLACE FUNCTION public.set_checklist_modelo_updated_at()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
begin
  new.atualizado_em := now();
  return new;
end $function$
;

CREATE OR REPLACE FUNCTION public.to_mercosul_equivalente(p text)
 RETURNS text
 LANGUAGE sql
 IMMUTABLE
AS $function$
  select
    case
      -- placa antiga: ABC1234 -> ABC1C34 (0->A ... 9->J)
      when p ~ '^[A-Z]{3}[0-9]{4}$' then
        substr(p,1,3) ||
        substr(p,4,1) ||
        chr(65 + cast(substr(p,5,1) as int)) ||
        substr(p,6,2)

      -- j√° no padr√£o novo (Mercosul): mant√©m
      when p ~ '^[A-Z]{3}[0-9][A-Z0-9][0-9]{2}$' then
        p

      else null
    end;
$function$
;

CREATE OR REPLACE FUNCTION public.trg_os_status_estornar()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
begin
  -- Quando a OS for recusada, devolve tudo que j√° foi baixado
  if new.status = 'ORCAMENTO_RECUSADO' and (old.status is distinct from 'ORCAMENTO_RECUSADO') then
    perform public.estornar_baixa_estoque_os(new.id);
  end if;
  return new;
end
$function$
;

grant delete on table "public"."bancoconta" to "anon";

grant insert on table "public"."bancoconta" to "anon";

grant references on table "public"."bancoconta" to "anon";

grant select on table "public"."bancoconta" to "anon";

grant trigger on table "public"."bancoconta" to "anon";

grant truncate on table "public"."bancoconta" to "anon";

grant update on table "public"."bancoconta" to "anon";

grant delete on table "public"."bancoconta" to "authenticated";

grant insert on table "public"."bancoconta" to "authenticated";

grant references on table "public"."bancoconta" to "authenticated";

grant select on table "public"."bancoconta" to "authenticated";

grant trigger on table "public"."bancoconta" to "authenticated";

grant truncate on table "public"."bancoconta" to "authenticated";

grant update on table "public"."bancoconta" to "authenticated";

grant delete on table "public"."bancoconta" to "service_role";

grant insert on table "public"."bancoconta" to "service_role";

grant references on table "public"."bancoconta" to "service_role";

grant select on table "public"."bancoconta" to "service_role";

grant trigger on table "public"."bancoconta" to "service_role";

grant truncate on table "public"."bancoconta" to "service_role";

grant update on table "public"."bancoconta" to "service_role";

grant delete on table "public"."categoriaservico" to "anon";

grant insert on table "public"."categoriaservico" to "anon";

grant references on table "public"."categoriaservico" to "anon";

grant select on table "public"."categoriaservico" to "anon";

grant trigger on table "public"."categoriaservico" to "anon";

grant truncate on table "public"."categoriaservico" to "anon";

grant update on table "public"."categoriaservico" to "anon";

grant delete on table "public"."categoriaservico" to "authenticated";

grant insert on table "public"."categoriaservico" to "authenticated";

grant references on table "public"."categoriaservico" to "authenticated";

grant select on table "public"."categoriaservico" to "authenticated";

grant trigger on table "public"."categoriaservico" to "authenticated";

grant truncate on table "public"."categoriaservico" to "authenticated";

grant update on table "public"."categoriaservico" to "authenticated";

grant delete on table "public"."categoriaservico" to "service_role";

grant insert on table "public"."categoriaservico" to "service_role";

grant references on table "public"."categoriaservico" to "service_role";

grant select on table "public"."categoriaservico" to "service_role";

grant trigger on table "public"."categoriaservico" to "service_role";

grant truncate on table "public"."categoriaservico" to "service_role";

grant update on table "public"."categoriaservico" to "service_role";

grant delete on table "public"."categoriatransacao" to "anon";

grant insert on table "public"."categoriatransacao" to "anon";

grant references on table "public"."categoriatransacao" to "anon";

grant select on table "public"."categoriatransacao" to "anon";

grant trigger on table "public"."categoriatransacao" to "anon";

grant truncate on table "public"."categoriatransacao" to "anon";

grant update on table "public"."categoriatransacao" to "anon";

grant delete on table "public"."categoriatransacao" to "authenticated";

grant insert on table "public"."categoriatransacao" to "authenticated";

grant references on table "public"."categoriatransacao" to "authenticated";

grant select on table "public"."categoriatransacao" to "authenticated";

grant trigger on table "public"."categoriatransacao" to "authenticated";

grant truncate on table "public"."categoriatransacao" to "authenticated";

grant update on table "public"."categoriatransacao" to "authenticated";

grant delete on table "public"."categoriatransacao" to "service_role";

grant insert on table "public"."categoriatransacao" to "service_role";

grant references on table "public"."categoriatransacao" to "service_role";

grant select on table "public"."categoriatransacao" to "service_role";

grant trigger on table "public"."categoriatransacao" to "service_role";

grant truncate on table "public"."categoriatransacao" to "service_role";

grant update on table "public"."categoriatransacao" to "service_role";

grant delete on table "public"."checklist" to "anon";

grant insert on table "public"."checklist" to "anon";

grant references on table "public"."checklist" to "anon";

grant select on table "public"."checklist" to "anon";

grant trigger on table "public"."checklist" to "anon";

grant truncate on table "public"."checklist" to "anon";

grant update on table "public"."checklist" to "anon";

grant delete on table "public"."checklist" to "authenticated";

grant insert on table "public"."checklist" to "authenticated";

grant references on table "public"."checklist" to "authenticated";

grant select on table "public"."checklist" to "authenticated";

grant trigger on table "public"."checklist" to "authenticated";

grant truncate on table "public"."checklist" to "authenticated";

grant update on table "public"."checklist" to "authenticated";

grant delete on table "public"."checklist" to "service_role";

grant insert on table "public"."checklist" to "service_role";

grant references on table "public"."checklist" to "service_role";

grant select on table "public"."checklist" to "service_role";

grant trigger on table "public"."checklist" to "service_role";

grant truncate on table "public"."checklist" to "service_role";

grant update on table "public"."checklist" to "service_role";

grant delete on table "public"."checklist_modelo" to "anon";

grant insert on table "public"."checklist_modelo" to "anon";

grant references on table "public"."checklist_modelo" to "anon";

grant select on table "public"."checklist_modelo" to "anon";

grant trigger on table "public"."checklist_modelo" to "anon";

grant truncate on table "public"."checklist_modelo" to "anon";

grant update on table "public"."checklist_modelo" to "anon";

grant delete on table "public"."checklist_modelo" to "authenticated";

grant insert on table "public"."checklist_modelo" to "authenticated";

grant references on table "public"."checklist_modelo" to "authenticated";

grant select on table "public"."checklist_modelo" to "authenticated";

grant trigger on table "public"."checklist_modelo" to "authenticated";

grant truncate on table "public"."checklist_modelo" to "authenticated";

grant update on table "public"."checklist_modelo" to "authenticated";

grant delete on table "public"."checklist_modelo" to "service_role";

grant insert on table "public"."checklist_modelo" to "service_role";

grant references on table "public"."checklist_modelo" to "service_role";

grant select on table "public"."checklist_modelo" to "service_role";

grant trigger on table "public"."checklist_modelo" to "service_role";

grant truncate on table "public"."checklist_modelo" to "service_role";

grant update on table "public"."checklist_modelo" to "service_role";

grant delete on table "public"."checklist_modelo_item" to "anon";

grant insert on table "public"."checklist_modelo_item" to "anon";

grant references on table "public"."checklist_modelo_item" to "anon";

grant select on table "public"."checklist_modelo_item" to "anon";

grant trigger on table "public"."checklist_modelo_item" to "anon";

grant truncate on table "public"."checklist_modelo_item" to "anon";

grant update on table "public"."checklist_modelo_item" to "anon";

grant delete on table "public"."checklist_modelo_item" to "authenticated";

grant insert on table "public"."checklist_modelo_item" to "authenticated";

grant references on table "public"."checklist_modelo_item" to "authenticated";

grant select on table "public"."checklist_modelo_item" to "authenticated";

grant trigger on table "public"."checklist_modelo_item" to "authenticated";

grant truncate on table "public"."checklist_modelo_item" to "authenticated";

grant update on table "public"."checklist_modelo_item" to "authenticated";

grant delete on table "public"."checklist_modelo_item" to "service_role";

grant insert on table "public"."checklist_modelo_item" to "service_role";

grant references on table "public"."checklist_modelo_item" to "service_role";

grant select on table "public"."checklist_modelo_item" to "service_role";

grant trigger on table "public"."checklist_modelo_item" to "service_role";

grant truncate on table "public"."checklist_modelo_item" to "service_role";

grant update on table "public"."checklist_modelo_item" to "service_role";

grant delete on table "public"."cliente" to "anon";

grant insert on table "public"."cliente" to "anon";

grant references on table "public"."cliente" to "anon";

grant select on table "public"."cliente" to "anon";

grant trigger on table "public"."cliente" to "anon";

grant truncate on table "public"."cliente" to "anon";

grant update on table "public"."cliente" to "anon";

grant delete on table "public"."cliente" to "authenticated";

grant insert on table "public"."cliente" to "authenticated";

grant references on table "public"."cliente" to "authenticated";

grant select on table "public"."cliente" to "authenticated";

grant trigger on table "public"."cliente" to "authenticated";

grant truncate on table "public"."cliente" to "authenticated";

grant update on table "public"."cliente" to "authenticated";

grant delete on table "public"."cliente" to "service_role";

grant insert on table "public"."cliente" to "service_role";

grant references on table "public"."cliente" to "service_role";

grant select on table "public"."cliente" to "service_role";

grant trigger on table "public"."cliente" to "service_role";

grant truncate on table "public"."cliente" to "service_role";

grant update on table "public"."cliente" to "service_role";

grant delete on table "public"."cores_veiculos" to "anon";

grant insert on table "public"."cores_veiculos" to "anon";

grant references on table "public"."cores_veiculos" to "anon";

grant select on table "public"."cores_veiculos" to "anon";

grant trigger on table "public"."cores_veiculos" to "anon";

grant truncate on table "public"."cores_veiculos" to "anon";

grant update on table "public"."cores_veiculos" to "anon";

grant delete on table "public"."cores_veiculos" to "authenticated";

grant insert on table "public"."cores_veiculos" to "authenticated";

grant references on table "public"."cores_veiculos" to "authenticated";

grant select on table "public"."cores_veiculos" to "authenticated";

grant trigger on table "public"."cores_veiculos" to "authenticated";

grant truncate on table "public"."cores_veiculos" to "authenticated";

grant update on table "public"."cores_veiculos" to "authenticated";

grant delete on table "public"."cores_veiculos" to "service_role";

grant insert on table "public"."cores_veiculos" to "service_role";

grant references on table "public"."cores_veiculos" to "service_role";

grant select on table "public"."cores_veiculos" to "service_role";

grant trigger on table "public"."cores_veiculos" to "service_role";

grant truncate on table "public"."cores_veiculos" to "service_role";

grant update on table "public"."cores_veiculos" to "service_role";

grant delete on table "public"."empresa" to "anon";

grant insert on table "public"."empresa" to "anon";

grant references on table "public"."empresa" to "anon";

grant select on table "public"."empresa" to "anon";

grant trigger on table "public"."empresa" to "anon";

grant truncate on table "public"."empresa" to "anon";

grant update on table "public"."empresa" to "anon";

grant delete on table "public"."empresa" to "authenticated";

grant insert on table "public"."empresa" to "authenticated";

grant references on table "public"."empresa" to "authenticated";

grant select on table "public"."empresa" to "authenticated";

grant trigger on table "public"."empresa" to "authenticated";

grant truncate on table "public"."empresa" to "authenticated";

grant update on table "public"."empresa" to "authenticated";

grant delete on table "public"."empresa" to "service_role";

grant insert on table "public"."empresa" to "service_role";

grant references on table "public"."empresa" to "service_role";

grant select on table "public"."empresa" to "service_role";

grant trigger on table "public"."empresa" to "service_role";

grant truncate on table "public"."empresa" to "service_role";

grant update on table "public"."empresa" to "service_role";

grant delete on table "public"."fornecedor" to "anon";

grant insert on table "public"."fornecedor" to "anon";

grant references on table "public"."fornecedor" to "anon";

grant select on table "public"."fornecedor" to "anon";

grant trigger on table "public"."fornecedor" to "anon";

grant truncate on table "public"."fornecedor" to "anon";

grant update on table "public"."fornecedor" to "anon";

grant delete on table "public"."fornecedor" to "authenticated";

grant insert on table "public"."fornecedor" to "authenticated";

grant references on table "public"."fornecedor" to "authenticated";

grant select on table "public"."fornecedor" to "authenticated";

grant trigger on table "public"."fornecedor" to "authenticated";

grant truncate on table "public"."fornecedor" to "authenticated";

grant update on table "public"."fornecedor" to "authenticated";

grant delete on table "public"."fornecedor" to "service_role";

grant insert on table "public"."fornecedor" to "service_role";

grant references on table "public"."fornecedor" to "service_role";

grant select on table "public"."fornecedor" to "service_role";

grant trigger on table "public"."fornecedor" to "service_role";

grant truncate on table "public"."fornecedor" to "service_role";

grant update on table "public"."fornecedor" to "service_role";

grant delete on table "public"."fornecedorprodutos" to "anon";

grant insert on table "public"."fornecedorprodutos" to "anon";

grant references on table "public"."fornecedorprodutos" to "anon";

grant select on table "public"."fornecedorprodutos" to "anon";

grant trigger on table "public"."fornecedorprodutos" to "anon";

grant truncate on table "public"."fornecedorprodutos" to "anon";

grant update on table "public"."fornecedorprodutos" to "anon";

grant delete on table "public"."fornecedorprodutos" to "authenticated";

grant insert on table "public"."fornecedorprodutos" to "authenticated";

grant references on table "public"."fornecedorprodutos" to "authenticated";

grant select on table "public"."fornecedorprodutos" to "authenticated";

grant trigger on table "public"."fornecedorprodutos" to "authenticated";

grant truncate on table "public"."fornecedorprodutos" to "authenticated";

grant update on table "public"."fornecedorprodutos" to "authenticated";

grant delete on table "public"."fornecedorprodutos" to "service_role";

grant insert on table "public"."fornecedorprodutos" to "service_role";

grant references on table "public"."fornecedorprodutos" to "service_role";

grant select on table "public"."fornecedorprodutos" to "service_role";

grant trigger on table "public"."fornecedorprodutos" to "service_role";

grant truncate on table "public"."fornecedorprodutos" to "service_role";

grant update on table "public"."fornecedorprodutos" to "service_role";

grant delete on table "public"."imagemvistoria" to "anon";

grant insert on table "public"."imagemvistoria" to "anon";

grant references on table "public"."imagemvistoria" to "anon";

grant select on table "public"."imagemvistoria" to "anon";

grant trigger on table "public"."imagemvistoria" to "anon";

grant truncate on table "public"."imagemvistoria" to "anon";

grant update on table "public"."imagemvistoria" to "anon";

grant delete on table "public"."imagemvistoria" to "authenticated";

grant insert on table "public"."imagemvistoria" to "authenticated";

grant references on table "public"."imagemvistoria" to "authenticated";

grant select on table "public"."imagemvistoria" to "authenticated";

grant trigger on table "public"."imagemvistoria" to "authenticated";

grant truncate on table "public"."imagemvistoria" to "authenticated";

grant update on table "public"."imagemvistoria" to "authenticated";

grant delete on table "public"."imagemvistoria" to "service_role";

grant insert on table "public"."imagemvistoria" to "service_role";

grant references on table "public"."imagemvistoria" to "service_role";

grant select on table "public"."imagemvistoria" to "service_role";

grant trigger on table "public"."imagemvistoria" to "service_role";

grant truncate on table "public"."imagemvistoria" to "service_role";

grant update on table "public"."imagemvistoria" to "service_role";

grant delete on table "public"."nfe" to "anon";

grant insert on table "public"."nfe" to "anon";

grant references on table "public"."nfe" to "anon";

grant select on table "public"."nfe" to "anon";

grant trigger on table "public"."nfe" to "anon";

grant truncate on table "public"."nfe" to "anon";

grant update on table "public"."nfe" to "anon";

grant delete on table "public"."nfe" to "authenticated";

grant insert on table "public"."nfe" to "authenticated";

grant references on table "public"."nfe" to "authenticated";

grant select on table "public"."nfe" to "authenticated";

grant trigger on table "public"."nfe" to "authenticated";

grant truncate on table "public"."nfe" to "authenticated";

grant update on table "public"."nfe" to "authenticated";

grant delete on table "public"."nfe" to "service_role";

grant insert on table "public"."nfe" to "service_role";

grant references on table "public"."nfe" to "service_role";

grant select on table "public"."nfe" to "service_role";

grant trigger on table "public"."nfe" to "service_role";

grant truncate on table "public"."nfe" to "service_role";

grant update on table "public"."nfe" to "service_role";

grant delete on table "public"."nfe_config" to "anon";

grant insert on table "public"."nfe_config" to "anon";

grant references on table "public"."nfe_config" to "anon";

grant select on table "public"."nfe_config" to "anon";

grant trigger on table "public"."nfe_config" to "anon";

grant truncate on table "public"."nfe_config" to "anon";

grant update on table "public"."nfe_config" to "anon";

grant delete on table "public"."nfe_config" to "authenticated";

grant insert on table "public"."nfe_config" to "authenticated";

grant references on table "public"."nfe_config" to "authenticated";

grant select on table "public"."nfe_config" to "authenticated";

grant trigger on table "public"."nfe_config" to "authenticated";

grant truncate on table "public"."nfe_config" to "authenticated";

grant update on table "public"."nfe_config" to "authenticated";

grant delete on table "public"."nfe_config" to "service_role";

grant insert on table "public"."nfe_config" to "service_role";

grant references on table "public"."nfe_config" to "service_role";

grant select on table "public"."nfe_config" to "service_role";

grant trigger on table "public"."nfe_config" to "service_role";

grant truncate on table "public"."nfe_config" to "service_role";

grant update on table "public"."nfe_config" to "service_role";

grant delete on table "public"."nfe_item" to "anon";

grant insert on table "public"."nfe_item" to "anon";

grant references on table "public"."nfe_item" to "anon";

grant select on table "public"."nfe_item" to "anon";

grant trigger on table "public"."nfe_item" to "anon";

grant truncate on table "public"."nfe_item" to "anon";

grant update on table "public"."nfe_item" to "anon";

grant delete on table "public"."nfe_item" to "authenticated";

grant insert on table "public"."nfe_item" to "authenticated";

grant references on table "public"."nfe_item" to "authenticated";

grant select on table "public"."nfe_item" to "authenticated";

grant trigger on table "public"."nfe_item" to "authenticated";

grant truncate on table "public"."nfe_item" to "authenticated";

grant update on table "public"."nfe_item" to "authenticated";

grant delete on table "public"."nfe_item" to "service_role";

grant insert on table "public"."nfe_item" to "service_role";

grant references on table "public"."nfe_item" to "service_role";

grant select on table "public"."nfe_item" to "service_role";

grant trigger on table "public"."nfe_item" to "service_role";

grant truncate on table "public"."nfe_item" to "service_role";

grant update on table "public"."nfe_item" to "service_role";

grant delete on table "public"."nfse_config" to "anon";

grant insert on table "public"."nfse_config" to "anon";

grant references on table "public"."nfse_config" to "anon";

grant select on table "public"."nfse_config" to "anon";

grant trigger on table "public"."nfse_config" to "anon";

grant truncate on table "public"."nfse_config" to "anon";

grant update on table "public"."nfse_config" to "anon";

grant delete on table "public"."nfse_config" to "authenticated";

grant insert on table "public"."nfse_config" to "authenticated";

grant references on table "public"."nfse_config" to "authenticated";

grant select on table "public"."nfse_config" to "authenticated";

grant trigger on table "public"."nfse_config" to "authenticated";

grant truncate on table "public"."nfse_config" to "authenticated";

grant update on table "public"."nfse_config" to "authenticated";

grant delete on table "public"."nfse_config" to "service_role";

grant insert on table "public"."nfse_config" to "service_role";

grant references on table "public"."nfse_config" to "service_role";

grant select on table "public"."nfse_config" to "service_role";

grant trigger on table "public"."nfse_config" to "service_role";

grant truncate on table "public"."nfse_config" to "service_role";

grant update on table "public"."nfse_config" to "service_role";

grant delete on table "public"."notafiscal" to "anon";

grant insert on table "public"."notafiscal" to "anon";

grant references on table "public"."notafiscal" to "anon";

grant select on table "public"."notafiscal" to "anon";

grant trigger on table "public"."notafiscal" to "anon";

grant truncate on table "public"."notafiscal" to "anon";

grant update on table "public"."notafiscal" to "anon";

grant delete on table "public"."notafiscal" to "authenticated";

grant insert on table "public"."notafiscal" to "authenticated";

grant references on table "public"."notafiscal" to "authenticated";

grant select on table "public"."notafiscal" to "authenticated";

grant trigger on table "public"."notafiscal" to "authenticated";

grant truncate on table "public"."notafiscal" to "authenticated";

grant update on table "public"."notafiscal" to "authenticated";

grant delete on table "public"."notafiscal" to "service_role";

grant insert on table "public"."notafiscal" to "service_role";

grant references on table "public"."notafiscal" to "service_role";

grant select on table "public"."notafiscal" to "service_role";

grant trigger on table "public"."notafiscal" to "service_role";

grant truncate on table "public"."notafiscal" to "service_role";

grant update on table "public"."notafiscal" to "service_role";

grant delete on table "public"."ordemservico" to "anon";

grant insert on table "public"."ordemservico" to "anon";

grant references on table "public"."ordemservico" to "anon";

grant select on table "public"."ordemservico" to "anon";

grant trigger on table "public"."ordemservico" to "anon";

grant truncate on table "public"."ordemservico" to "anon";

grant update on table "public"."ordemservico" to "anon";

grant delete on table "public"."ordemservico" to "authenticated";

grant insert on table "public"."ordemservico" to "authenticated";

grant references on table "public"."ordemservico" to "authenticated";

grant select on table "public"."ordemservico" to "authenticated";

grant trigger on table "public"."ordemservico" to "authenticated";

grant truncate on table "public"."ordemservico" to "authenticated";

grant update on table "public"."ordemservico" to "authenticated";

grant delete on table "public"."ordemservico" to "service_role";

grant insert on table "public"."ordemservico" to "service_role";

grant references on table "public"."ordemservico" to "service_role";

grant select on table "public"."ordemservico" to "service_role";

grant trigger on table "public"."ordemservico" to "service_role";

grant truncate on table "public"."ordemservico" to "service_role";

grant update on table "public"."ordemservico" to "service_role";

grant delete on table "public"."osaprovacao" to "anon";

grant insert on table "public"."osaprovacao" to "anon";

grant references on table "public"."osaprovacao" to "anon";

grant select on table "public"."osaprovacao" to "anon";

grant trigger on table "public"."osaprovacao" to "anon";

grant truncate on table "public"."osaprovacao" to "anon";

grant update on table "public"."osaprovacao" to "anon";

grant delete on table "public"."osaprovacao" to "authenticated";

grant insert on table "public"."osaprovacao" to "authenticated";

grant references on table "public"."osaprovacao" to "authenticated";

grant select on table "public"."osaprovacao" to "authenticated";

grant trigger on table "public"."osaprovacao" to "authenticated";

grant truncate on table "public"."osaprovacao" to "authenticated";

grant update on table "public"."osaprovacao" to "authenticated";

grant delete on table "public"."osaprovacao" to "service_role";

grant insert on table "public"."osaprovacao" to "service_role";

grant references on table "public"."osaprovacao" to "service_role";

grant select on table "public"."osaprovacao" to "service_role";

grant trigger on table "public"."osaprovacao" to "service_role";

grant truncate on table "public"."osaprovacao" to "service_role";

grant update on table "public"."osaprovacao" to "service_role";

grant delete on table "public"."osproduto" to "anon";

grant insert on table "public"."osproduto" to "anon";

grant references on table "public"."osproduto" to "anon";

grant select on table "public"."osproduto" to "anon";

grant trigger on table "public"."osproduto" to "anon";

grant truncate on table "public"."osproduto" to "anon";

grant update on table "public"."osproduto" to "anon";

grant delete on table "public"."osproduto" to "authenticated";

grant insert on table "public"."osproduto" to "authenticated";

grant references on table "public"."osproduto" to "authenticated";

grant select on table "public"."osproduto" to "authenticated";

grant trigger on table "public"."osproduto" to "authenticated";

grant truncate on table "public"."osproduto" to "authenticated";

grant update on table "public"."osproduto" to "authenticated";

grant delete on table "public"."osproduto" to "service_role";

grant insert on table "public"."osproduto" to "service_role";

grant references on table "public"."osproduto" to "service_role";

grant select on table "public"."osproduto" to "service_role";

grant trigger on table "public"."osproduto" to "service_role";

grant truncate on table "public"."osproduto" to "service_role";

grant update on table "public"."osproduto" to "service_role";

grant delete on table "public"."osproduto_baixa" to "anon";

grant insert on table "public"."osproduto_baixa" to "anon";

grant references on table "public"."osproduto_baixa" to "anon";

grant select on table "public"."osproduto_baixa" to "anon";

grant trigger on table "public"."osproduto_baixa" to "anon";

grant truncate on table "public"."osproduto_baixa" to "anon";

grant update on table "public"."osproduto_baixa" to "anon";

grant delete on table "public"."osproduto_baixa" to "authenticated";

grant insert on table "public"."osproduto_baixa" to "authenticated";

grant references on table "public"."osproduto_baixa" to "authenticated";

grant select on table "public"."osproduto_baixa" to "authenticated";

grant trigger on table "public"."osproduto_baixa" to "authenticated";

grant truncate on table "public"."osproduto_baixa" to "authenticated";

grant update on table "public"."osproduto_baixa" to "authenticated";

grant delete on table "public"."osproduto_baixa" to "service_role";

grant insert on table "public"."osproduto_baixa" to "service_role";

grant references on table "public"."osproduto_baixa" to "service_role";

grant select on table "public"."osproduto_baixa" to "service_role";

grant trigger on table "public"."osproduto_baixa" to "service_role";

grant truncate on table "public"."osproduto_baixa" to "service_role";

grant update on table "public"."osproduto_baixa" to "service_role";

grant delete on table "public"."osservico" to "anon";

grant insert on table "public"."osservico" to "anon";

grant references on table "public"."osservico" to "anon";

grant select on table "public"."osservico" to "anon";

grant trigger on table "public"."osservico" to "anon";

grant truncate on table "public"."osservico" to "anon";

grant update on table "public"."osservico" to "anon";

grant delete on table "public"."osservico" to "authenticated";

grant insert on table "public"."osservico" to "authenticated";

grant references on table "public"."osservico" to "authenticated";

grant select on table "public"."osservico" to "authenticated";

grant trigger on table "public"."osservico" to "authenticated";

grant truncate on table "public"."osservico" to "authenticated";

grant update on table "public"."osservico" to "authenticated";

grant delete on table "public"."osservico" to "service_role";

grant insert on table "public"."osservico" to "service_role";

grant references on table "public"."osservico" to "service_role";

grant select on table "public"."osservico" to "service_role";

grant trigger on table "public"."osservico" to "service_role";

grant truncate on table "public"."osservico" to "service_role";

grant update on table "public"."osservico" to "service_role";

grant delete on table "public"."pagamento" to "anon";

grant insert on table "public"."pagamento" to "anon";

grant references on table "public"."pagamento" to "anon";

grant select on table "public"."pagamento" to "anon";

grant trigger on table "public"."pagamento" to "anon";

grant truncate on table "public"."pagamento" to "anon";

grant update on table "public"."pagamento" to "anon";

grant delete on table "public"."pagamento" to "authenticated";

grant insert on table "public"."pagamento" to "authenticated";

grant references on table "public"."pagamento" to "authenticated";

grant select on table "public"."pagamento" to "authenticated";

grant trigger on table "public"."pagamento" to "authenticated";

grant truncate on table "public"."pagamento" to "authenticated";

grant update on table "public"."pagamento" to "authenticated";

grant delete on table "public"."pagamento" to "service_role";

grant insert on table "public"."pagamento" to "service_role";

grant references on table "public"."pagamento" to "service_role";

grant select on table "public"."pagamento" to "service_role";

grant trigger on table "public"."pagamento" to "service_role";

grant truncate on table "public"."pagamento" to "service_role";

grant update on table "public"."pagamento" to "service_role";

grant delete on table "public"."pagamento_config" to "anon";

grant insert on table "public"."pagamento_config" to "anon";

grant references on table "public"."pagamento_config" to "anon";

grant select on table "public"."pagamento_config" to "anon";

grant trigger on table "public"."pagamento_config" to "anon";

grant truncate on table "public"."pagamento_config" to "anon";

grant update on table "public"."pagamento_config" to "anon";

grant delete on table "public"."pagamento_config" to "authenticated";

grant insert on table "public"."pagamento_config" to "authenticated";

grant references on table "public"."pagamento_config" to "authenticated";

grant select on table "public"."pagamento_config" to "authenticated";

grant trigger on table "public"."pagamento_config" to "authenticated";

grant truncate on table "public"."pagamento_config" to "authenticated";

grant update on table "public"."pagamento_config" to "authenticated";

grant delete on table "public"."pagamento_config" to "service_role";

grant insert on table "public"."pagamento_config" to "service_role";

grant references on table "public"."pagamento_config" to "service_role";

grant select on table "public"."pagamento_config" to "service_role";

grant trigger on table "public"."pagamento_config" to "service_role";

grant truncate on table "public"."pagamento_config" to "service_role";

grant update on table "public"."pagamento_config" to "service_role";

grant delete on table "public"."pagamento_evento" to "anon";

grant insert on table "public"."pagamento_evento" to "anon";

grant references on table "public"."pagamento_evento" to "anon";

grant select on table "public"."pagamento_evento" to "anon";

grant trigger on table "public"."pagamento_evento" to "anon";

grant truncate on table "public"."pagamento_evento" to "anon";

grant update on table "public"."pagamento_evento" to "anon";

grant delete on table "public"."pagamento_evento" to "authenticated";

grant insert on table "public"."pagamento_evento" to "authenticated";

grant references on table "public"."pagamento_evento" to "authenticated";

grant select on table "public"."pagamento_evento" to "authenticated";

grant trigger on table "public"."pagamento_evento" to "authenticated";

grant truncate on table "public"."pagamento_evento" to "authenticated";

grant update on table "public"."pagamento_evento" to "authenticated";

grant delete on table "public"."pagamento_evento" to "service_role";

grant insert on table "public"."pagamento_evento" to "service_role";

grant references on table "public"."pagamento_evento" to "service_role";

grant select on table "public"."pagamento_evento" to "service_role";

grant trigger on table "public"."pagamento_evento" to "service_role";

grant truncate on table "public"."pagamento_evento" to "service_role";

grant update on table "public"."pagamento_evento" to "service_role";

grant delete on table "public"."peca" to "anon";

grant insert on table "public"."peca" to "anon";

grant references on table "public"."peca" to "anon";

grant select on table "public"."peca" to "anon";

grant trigger on table "public"."peca" to "anon";

grant truncate on table "public"."peca" to "anon";

grant update on table "public"."peca" to "anon";

grant delete on table "public"."peca" to "authenticated";

grant insert on table "public"."peca" to "authenticated";

grant references on table "public"."peca" to "authenticated";

grant select on table "public"."peca" to "authenticated";

grant trigger on table "public"."peca" to "authenticated";

grant truncate on table "public"."peca" to "authenticated";

grant update on table "public"."peca" to "authenticated";

grant delete on table "public"."peca" to "service_role";

grant insert on table "public"."peca" to "service_role";

grant references on table "public"."peca" to "service_role";

grant select on table "public"."peca" to "service_role";

grant trigger on table "public"."peca" to "service_role";

grant truncate on table "public"."peca" to "service_role";

grant update on table "public"."peca" to "service_role";

grant delete on table "public"."perfil" to "anon";

grant insert on table "public"."perfil" to "anon";

grant references on table "public"."perfil" to "anon";

grant select on table "public"."perfil" to "anon";

grant trigger on table "public"."perfil" to "anon";

grant truncate on table "public"."perfil" to "anon";

grant update on table "public"."perfil" to "anon";

grant delete on table "public"."perfil" to "authenticated";

grant insert on table "public"."perfil" to "authenticated";

grant references on table "public"."perfil" to "authenticated";

grant select on table "public"."perfil" to "authenticated";

grant trigger on table "public"."perfil" to "authenticated";

grant truncate on table "public"."perfil" to "authenticated";

grant update on table "public"."perfil" to "authenticated";

grant delete on table "public"."perfil" to "service_role";

grant insert on table "public"."perfil" to "service_role";

grant references on table "public"."perfil" to "service_role";

grant select on table "public"."perfil" to "service_role";

grant trigger on table "public"."perfil" to "service_role";

grant truncate on table "public"."perfil" to "service_role";

grant update on table "public"."perfil" to "service_role";

grant delete on table "public"."perfilpermissao" to "anon";

grant insert on table "public"."perfilpermissao" to "anon";

grant references on table "public"."perfilpermissao" to "anon";

grant select on table "public"."perfilpermissao" to "anon";

grant trigger on table "public"."perfilpermissao" to "anon";

grant truncate on table "public"."perfilpermissao" to "anon";

grant update on table "public"."perfilpermissao" to "anon";

grant delete on table "public"."perfilpermissao" to "authenticated";

grant insert on table "public"."perfilpermissao" to "authenticated";

grant references on table "public"."perfilpermissao" to "authenticated";

grant select on table "public"."perfilpermissao" to "authenticated";

grant trigger on table "public"."perfilpermissao" to "authenticated";

grant truncate on table "public"."perfilpermissao" to "authenticated";

grant update on table "public"."perfilpermissao" to "authenticated";

grant delete on table "public"."perfilpermissao" to "service_role";

grant insert on table "public"."perfilpermissao" to "service_role";

grant references on table "public"."perfilpermissao" to "service_role";

grant select on table "public"."perfilpermissao" to "service_role";

grant trigger on table "public"."perfilpermissao" to "service_role";

grant truncate on table "public"."perfilpermissao" to "service_role";

grant update on table "public"."perfilpermissao" to "service_role";

grant delete on table "public"."permissao" to "anon";

grant insert on table "public"."permissao" to "anon";

grant references on table "public"."permissao" to "anon";

grant select on table "public"."permissao" to "anon";

grant trigger on table "public"."permissao" to "anon";

grant truncate on table "public"."permissao" to "anon";

grant update on table "public"."permissao" to "anon";

grant delete on table "public"."permissao" to "authenticated";

grant insert on table "public"."permissao" to "authenticated";

grant references on table "public"."permissao" to "authenticated";

grant select on table "public"."permissao" to "authenticated";

grant trigger on table "public"."permissao" to "authenticated";

grant truncate on table "public"."permissao" to "authenticated";

grant update on table "public"."permissao" to "authenticated";

grant delete on table "public"."permissao" to "service_role";

grant insert on table "public"."permissao" to "service_role";

grant references on table "public"."permissao" to "service_role";

grant select on table "public"."permissao" to "service_role";

grant trigger on table "public"."permissao" to "service_role";

grant truncate on table "public"."permissao" to "service_role";

grant update on table "public"."permissao" to "service_role";

grant delete on table "public"."produto" to "anon";

grant insert on table "public"."produto" to "anon";

grant references on table "public"."produto" to "anon";

grant select on table "public"."produto" to "anon";

grant trigger on table "public"."produto" to "anon";

grant truncate on table "public"."produto" to "anon";

grant update on table "public"."produto" to "anon";

grant delete on table "public"."produto" to "authenticated";

grant insert on table "public"."produto" to "authenticated";

grant references on table "public"."produto" to "authenticated";

grant select on table "public"."produto" to "authenticated";

grant trigger on table "public"."produto" to "authenticated";

grant truncate on table "public"."produto" to "authenticated";

grant update on table "public"."produto" to "authenticated";

grant delete on table "public"."produto" to "service_role";

grant insert on table "public"."produto" to "service_role";

grant references on table "public"."produto" to "service_role";

grant select on table "public"."produto" to "service_role";

grant trigger on table "public"."produto" to "service_role";

grant truncate on table "public"."produto" to "service_role";

grant update on table "public"."produto" to "service_role";

grant delete on table "public"."produto_imagem" to "anon";

grant insert on table "public"."produto_imagem" to "anon";

grant references on table "public"."produto_imagem" to "anon";

grant select on table "public"."produto_imagem" to "anon";

grant trigger on table "public"."produto_imagem" to "anon";

grant truncate on table "public"."produto_imagem" to "anon";

grant update on table "public"."produto_imagem" to "anon";

grant delete on table "public"."produto_imagem" to "authenticated";

grant insert on table "public"."produto_imagem" to "authenticated";

grant references on table "public"."produto_imagem" to "authenticated";

grant select on table "public"."produto_imagem" to "authenticated";

grant trigger on table "public"."produto_imagem" to "authenticated";

grant truncate on table "public"."produto_imagem" to "authenticated";

grant update on table "public"."produto_imagem" to "authenticated";

grant delete on table "public"."produto_imagem" to "service_role";

grant insert on table "public"."produto_imagem" to "service_role";

grant references on table "public"."produto_imagem" to "service_role";

grant select on table "public"."produto_imagem" to "service_role";

grant trigger on table "public"."produto_imagem" to "service_role";

grant truncate on table "public"."produto_imagem" to "service_role";

grant update on table "public"."produto_imagem" to "service_role";

grant delete on table "public"."produtoentrada" to "anon";

grant insert on table "public"."produtoentrada" to "anon";

grant references on table "public"."produtoentrada" to "anon";

grant select on table "public"."produtoentrada" to "anon";

grant trigger on table "public"."produtoentrada" to "anon";

grant truncate on table "public"."produtoentrada" to "anon";

grant update on table "public"."produtoentrada" to "anon";

grant delete on table "public"."produtoentrada" to "authenticated";

grant insert on table "public"."produtoentrada" to "authenticated";

grant references on table "public"."produtoentrada" to "authenticated";

grant select on table "public"."produtoentrada" to "authenticated";

grant trigger on table "public"."produtoentrada" to "authenticated";

grant truncate on table "public"."produtoentrada" to "authenticated";

grant update on table "public"."produtoentrada" to "authenticated";

grant delete on table "public"."produtoentrada" to "service_role";

grant insert on table "public"."produtoentrada" to "service_role";

grant references on table "public"."produtoentrada" to "service_role";

grant select on table "public"."produtoentrada" to "service_role";

grant trigger on table "public"."produtoentrada" to "service_role";

grant truncate on table "public"."produtoentrada" to "service_role";

grant update on table "public"."produtoentrada" to "service_role";

grant delete on table "public"."produtogrupo" to "anon";

grant insert on table "public"."produtogrupo" to "anon";

grant references on table "public"."produtogrupo" to "anon";

grant select on table "public"."produtogrupo" to "anon";

grant trigger on table "public"."produtogrupo" to "anon";

grant truncate on table "public"."produtogrupo" to "anon";

grant update on table "public"."produtogrupo" to "anon";

grant delete on table "public"."produtogrupo" to "authenticated";

grant insert on table "public"."produtogrupo" to "authenticated";

grant references on table "public"."produtogrupo" to "authenticated";

grant select on table "public"."produtogrupo" to "authenticated";

grant trigger on table "public"."produtogrupo" to "authenticated";

grant truncate on table "public"."produtogrupo" to "authenticated";

grant update on table "public"."produtogrupo" to "authenticated";

grant delete on table "public"."produtogrupo" to "service_role";

grant insert on table "public"."produtogrupo" to "service_role";

grant references on table "public"."produtogrupo" to "service_role";

grant select on table "public"."produtogrupo" to "service_role";

grant trigger on table "public"."produtogrupo" to "service_role";

grant truncate on table "public"."produtogrupo" to "service_role";

grant update on table "public"."produtogrupo" to "service_role";

grant delete on table "public"."servico" to "anon";

grant insert on table "public"."servico" to "anon";

grant references on table "public"."servico" to "anon";

grant select on table "public"."servico" to "anon";

grant trigger on table "public"."servico" to "anon";

grant truncate on table "public"."servico" to "anon";

grant update on table "public"."servico" to "anon";

grant delete on table "public"."servico" to "authenticated";

grant insert on table "public"."servico" to "authenticated";

grant references on table "public"."servico" to "authenticated";

grant select on table "public"."servico" to "authenticated";

grant trigger on table "public"."servico" to "authenticated";

grant truncate on table "public"."servico" to "authenticated";

grant update on table "public"."servico" to "authenticated";

grant delete on table "public"."servico" to "service_role";

grant insert on table "public"."servico" to "service_role";

grant references on table "public"."servico" to "service_role";

grant select on table "public"."servico" to "service_role";

grant trigger on table "public"."servico" to "service_role";

grant truncate on table "public"."servico" to "service_role";

grant update on table "public"."servico" to "service_role";

grant delete on table "public"."setor" to "anon";

grant insert on table "public"."setor" to "anon";

grant references on table "public"."setor" to "anon";

grant select on table "public"."setor" to "anon";

grant trigger on table "public"."setor" to "anon";

grant truncate on table "public"."setor" to "anon";

grant update on table "public"."setor" to "anon";

grant delete on table "public"."setor" to "authenticated";

grant insert on table "public"."setor" to "authenticated";

grant references on table "public"."setor" to "authenticated";

grant select on table "public"."setor" to "authenticated";

grant trigger on table "public"."setor" to "authenticated";

grant truncate on table "public"."setor" to "authenticated";

grant update on table "public"."setor" to "authenticated";

grant delete on table "public"."setor" to "service_role";

grant insert on table "public"."setor" to "service_role";

grant references on table "public"."setor" to "service_role";

grant select on table "public"."setor" to "service_role";

grant trigger on table "public"."setor" to "service_role";

grant truncate on table "public"."setor" to "service_role";

grant update on table "public"."setor" to "service_role";

grant delete on table "public"."tiposervico" to "anon";

grant insert on table "public"."tiposervico" to "anon";

grant references on table "public"."tiposervico" to "anon";

grant select on table "public"."tiposervico" to "anon";

grant trigger on table "public"."tiposervico" to "anon";

grant truncate on table "public"."tiposervico" to "anon";

grant update on table "public"."tiposervico" to "anon";

grant delete on table "public"."tiposervico" to "authenticated";

grant insert on table "public"."tiposervico" to "authenticated";

grant references on table "public"."tiposervico" to "authenticated";

grant select on table "public"."tiposervico" to "authenticated";

grant trigger on table "public"."tiposervico" to "authenticated";

grant truncate on table "public"."tiposervico" to "authenticated";

grant update on table "public"."tiposervico" to "authenticated";

grant delete on table "public"."tiposervico" to "service_role";

grant insert on table "public"."tiposervico" to "service_role";

grant references on table "public"."tiposervico" to "service_role";

grant select on table "public"."tiposervico" to "service_role";

grant trigger on table "public"."tiposervico" to "service_role";

grant truncate on table "public"."tiposervico" to "service_role";

grant update on table "public"."tiposervico" to "service_role";

grant delete on table "public"."transacao" to "anon";

grant insert on table "public"."transacao" to "anon";

grant references on table "public"."transacao" to "anon";

grant select on table "public"."transacao" to "anon";

grant trigger on table "public"."transacao" to "anon";

grant truncate on table "public"."transacao" to "anon";

grant update on table "public"."transacao" to "anon";

grant delete on table "public"."transacao" to "authenticated";

grant insert on table "public"."transacao" to "authenticated";

grant references on table "public"."transacao" to "authenticated";

grant select on table "public"."transacao" to "authenticated";

grant trigger on table "public"."transacao" to "authenticated";

grant truncate on table "public"."transacao" to "authenticated";

grant update on table "public"."transacao" to "authenticated";

grant delete on table "public"."transacao" to "service_role";

grant insert on table "public"."transacao" to "service_role";

grant references on table "public"."transacao" to "service_role";

grant select on table "public"."transacao" to "service_role";

grant trigger on table "public"."transacao" to "service_role";

grant truncate on table "public"."transacao" to "service_role";

grant update on table "public"."transacao" to "service_role";

grant delete on table "public"."transferencias_veiculos" to "anon";

grant insert on table "public"."transferencias_veiculos" to "anon";

grant references on table "public"."transferencias_veiculos" to "anon";

grant select on table "public"."transferencias_veiculos" to "anon";

grant trigger on table "public"."transferencias_veiculos" to "anon";

grant truncate on table "public"."transferencias_veiculos" to "anon";

grant update on table "public"."transferencias_veiculos" to "anon";

grant delete on table "public"."transferencias_veiculos" to "authenticated";

grant insert on table "public"."transferencias_veiculos" to "authenticated";

grant references on table "public"."transferencias_veiculos" to "authenticated";

grant select on table "public"."transferencias_veiculos" to "authenticated";

grant trigger on table "public"."transferencias_veiculos" to "authenticated";

grant truncate on table "public"."transferencias_veiculos" to "authenticated";

grant update on table "public"."transferencias_veiculos" to "authenticated";

grant delete on table "public"."transferencias_veiculos" to "service_role";

grant insert on table "public"."transferencias_veiculos" to "service_role";

grant references on table "public"."transferencias_veiculos" to "service_role";

grant select on table "public"."transferencias_veiculos" to "service_role";

grant trigger on table "public"."transferencias_veiculos" to "service_role";

grant truncate on table "public"."transferencias_veiculos" to "service_role";

grant update on table "public"."transferencias_veiculos" to "service_role";

grant delete on table "public"."unidademedida" to "anon";

grant insert on table "public"."unidademedida" to "anon";

grant references on table "public"."unidademedida" to "anon";

grant select on table "public"."unidademedida" to "anon";

grant trigger on table "public"."unidademedida" to "anon";

grant truncate on table "public"."unidademedida" to "anon";

grant update on table "public"."unidademedida" to "anon";

grant delete on table "public"."unidademedida" to "authenticated";

grant insert on table "public"."unidademedida" to "authenticated";

grant references on table "public"."unidademedida" to "authenticated";

grant select on table "public"."unidademedida" to "authenticated";

grant trigger on table "public"."unidademedida" to "authenticated";

grant truncate on table "public"."unidademedida" to "authenticated";

grant update on table "public"."unidademedida" to "authenticated";

grant delete on table "public"."unidademedida" to "service_role";

grant insert on table "public"."unidademedida" to "service_role";

grant references on table "public"."unidademedida" to "service_role";

grant select on table "public"."unidademedida" to "service_role";

grant trigger on table "public"."unidademedida" to "service_role";

grant truncate on table "public"."unidademedida" to "service_role";

grant update on table "public"."unidademedida" to "service_role";

grant delete on table "public"."usuario" to "anon";

grant insert on table "public"."usuario" to "anon";

grant references on table "public"."usuario" to "anon";

grant select on table "public"."usuario" to "anon";

grant trigger on table "public"."usuario" to "anon";

grant truncate on table "public"."usuario" to "anon";

grant update on table "public"."usuario" to "anon";

grant delete on table "public"."usuario" to "authenticated";

grant insert on table "public"."usuario" to "authenticated";

grant references on table "public"."usuario" to "authenticated";

grant select on table "public"."usuario" to "authenticated";

grant trigger on table "public"."usuario" to "authenticated";

grant truncate on table "public"."usuario" to "authenticated";

grant update on table "public"."usuario" to "authenticated";

grant delete on table "public"."usuario" to "service_role";

grant insert on table "public"."usuario" to "service_role";

grant references on table "public"."usuario" to "service_role";

grant select on table "public"."usuario" to "service_role";

grant trigger on table "public"."usuario" to "service_role";

grant truncate on table "public"."usuario" to "service_role";

grant update on table "public"."usuario" to "service_role";

grant delete on table "public"."veiculo" to "anon";

grant insert on table "public"."veiculo" to "anon";

grant references on table "public"."veiculo" to "anon";

grant select on table "public"."veiculo" to "anon";

grant trigger on table "public"."veiculo" to "anon";

grant truncate on table "public"."veiculo" to "anon";

grant update on table "public"."veiculo" to "anon";

grant delete on table "public"."veiculo" to "authenticated";

grant insert on table "public"."veiculo" to "authenticated";

grant references on table "public"."veiculo" to "authenticated";

grant select on table "public"."veiculo" to "authenticated";

grant trigger on table "public"."veiculo" to "authenticated";

grant truncate on table "public"."veiculo" to "authenticated";

grant update on table "public"."veiculo" to "authenticated";

grant delete on table "public"."veiculo" to "service_role";

grant insert on table "public"."veiculo" to "service_role";

grant references on table "public"."veiculo" to "service_role";

grant select on table "public"."veiculo" to "service_role";

grant trigger on table "public"."veiculo" to "service_role";

grant truncate on table "public"."veiculo" to "service_role";

grant update on table "public"."veiculo" to "service_role";

grant delete on table "public"."venda" to "anon";

grant insert on table "public"."venda" to "anon";

grant references on table "public"."venda" to "anon";

grant select on table "public"."venda" to "anon";

grant trigger on table "public"."venda" to "anon";

grant truncate on table "public"."venda" to "anon";

grant update on table "public"."venda" to "anon";

grant delete on table "public"."venda" to "authenticated";

grant insert on table "public"."venda" to "authenticated";

grant references on table "public"."venda" to "authenticated";

grant select on table "public"."venda" to "authenticated";

grant trigger on table "public"."venda" to "authenticated";

grant truncate on table "public"."venda" to "authenticated";

grant update on table "public"."venda" to "authenticated";

grant delete on table "public"."venda" to "service_role";

grant insert on table "public"."venda" to "service_role";

grant references on table "public"."venda" to "service_role";

grant select on table "public"."venda" to "service_role";

grant trigger on table "public"."venda" to "service_role";

grant truncate on table "public"."venda" to "service_role";

grant update on table "public"."venda" to "service_role";

grant delete on table "public"."vendaproduto" to "anon";

grant insert on table "public"."vendaproduto" to "anon";

grant references on table "public"."vendaproduto" to "anon";

grant select on table "public"."vendaproduto" to "anon";

grant trigger on table "public"."vendaproduto" to "anon";

grant truncate on table "public"."vendaproduto" to "anon";

grant update on table "public"."vendaproduto" to "anon";

grant delete on table "public"."vendaproduto" to "authenticated";

grant insert on table "public"."vendaproduto" to "authenticated";

grant references on table "public"."vendaproduto" to "authenticated";

grant select on table "public"."vendaproduto" to "authenticated";

grant trigger on table "public"."vendaproduto" to "authenticated";

grant truncate on table "public"."vendaproduto" to "authenticated";

grant update on table "public"."vendaproduto" to "authenticated";

grant delete on table "public"."vendaproduto" to "service_role";

grant insert on table "public"."vendaproduto" to "service_role";

grant references on table "public"."vendaproduto" to "service_role";

grant select on table "public"."vendaproduto" to "service_role";

grant trigger on table "public"."vendaproduto" to "service_role";

grant truncate on table "public"."vendaproduto" to "service_role";

grant update on table "public"."vendaproduto" to "service_role";

CREATE TRIGGER trg_checklist_modelo_updated BEFORE UPDATE ON public.checklist_modelo FOR EACH ROW EXECUTE FUNCTION public.set_checklist_modelo_updated_at();

CREATE TRIGGER ordemservico_status_estorno AFTER UPDATE OF status ON public.ordemservico FOR EACH ROW EXECUTE FUNCTION public.trg_os_status_estornar();

CREATE TRIGGER trg_os_execucao_set_times BEFORE UPDATE OF status ON public.ordemservico FOR EACH ROW EXECUTE FUNCTION public.fn_os_execucao_set_times();

CREATE TRIGGER trg_fill_titulo_marketplace BEFORE INSERT OR UPDATE OF "tituloMarketplace", titulo ON public.produto FOR EACH ROW EXECUTE FUNCTION public.fn_fill_titulo_marketplace();

CREATE TRIGGER trg_set_status_estoque BEFORE INSERT OR UPDATE OF estoque, estoqueminimo ON public.produto FOR EACH ROW EXECUTE FUNCTION public.fn_set_status_estoque();

CREATE TRIGGER trg_normalize_placa_veiculo BEFORE INSERT OR UPDATE OF placa ON public.veiculo FOR EACH ROW EXECUTE FUNCTION public.normalize_placa();


